%%%      PLEASE RUN A SPELL CHECKER BEFORE COMMITTING YOUR CHANGES!
%%%      PLEASE RUN A SPELL CHECKER BEFORE COMMITTING YOUR CHANGES!
%%%      PLEASE RUN A SPELL CHECKER BEFORE COMMITTING YOUR CHANGES!
%%%      PLEASE RUN A SPELL CHECKER BEFORE COMMITTING YOUR CHANGES!
%%%      PLEASE RUN A SPELL CHECKER BEFORE COMMITTING YOUR CHANGES!

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{\label{sec:History-6-9}Development Release Series 6.9}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

This is the development release series of Condor.
The details of each version are described below.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{\label{sec:New-6-9-5}Version 6.9.5}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\noindent Release Notes:

\begin{itemize}

\item There are some known vulnerabilities in the Virtual Machine
  (VM) universe support included in this release that can allow VM
  universe jobs to read arbitrary files on the host machine.
  VM universe is disabled by default, so this potential vulnerability
  does not affect most sites.
  However, VM universe should not be enabled unless the job policy
  only allows users that you trust completely to run jobs on the
  machine.

\item Condor is now licensed under the terms of the Apache License
  version 2.0.

\item Dropped support for the following platforms:
\begin{itemize}
\item Red Hat Linux 7.x systems on the x86 processor.
\item Digital Unix systems on the Alpha processor.
\item Yellow Dog Linux 3.0 systems on the PPC processor.
\item MacOS 10.3 systems on the PPC processor.
\end{itemize}
Theses ports are still supported in the 6.8 series of Condor.

\item Dropped support for OGSA GRAM (grid-type gt3) in the grid
universe. This version of GRAM is not included in recent versions of
the Globus Toolkit. This does not affect Condor's support for pre-WS
GRAM (grid-type gt2) or WS GRAM (grid-type gt4).

\item The suggested configuration value for
\MacroNI{SHADOW\_RENICE\_INCREMENT} has been changed from 10 to 0.  If
using the value 10 in an existing configuration file, we recommend
changing it.  This improves the performance of Condor on busy submit nodes
where other processes would cause low priority \Condor{shadow} daemons
to become starved for CPU time.

\item For grid-type gt2 grid universe jobs, job arguments are now handled
as they are for all other job types. Previously, the user would have to
manually escape characters that had special meaning to GRAM's RSL
language.

\item \Condor{version} now includes a specific build
identification number for official builds of Condor.

\end{itemize}


\noindent New Features:

\begin{itemize}

\item \Condor{q}, when Quill is enabled, now displays the last time
Quill updated the database.  This permits seeing how fresh
the database information is.

\item \Condor{history}, when Quill is enabled, will now query the
database for historical items even when the \Opt{-constraint} option
is given.  Previously, it would go to the history file in that case.

\item \Condor{submit} can now write the ClassAds it generates to a
file instead of sending them to the \Condor{schedd} daemon.

\item When the \Condor{master} daemon sends an obituary e-mail,
it prints the last few lines of the log file for that daemon,
and the name of the file.
This e-mail now contains the full path name of that log file,
not just the file name.  This is more convenient for sites which
run multiple instances of the same daemon on one machine.

\item Added new policy for parallel universe jobs to control how they
exit.  If the attribute ParallelShutdownPolicy is set to the string
"WAIT\_FOR\_ALL", then Condor will wait until every node in the parallel
job has completed to consider the job finished.  If this attribute is
not set, or is set to any other string, the default policy is in effect.
This policy is needed for MPI jobs: when the first node exits, the whole
job is considered done, and condor kills all other running nodes in that
parallel job.

\item Added new Windows specific ClassAd attributes:
 \begin{itemize}
 \item \AdAttr{WindowsMajorVersion}
 \item \AdAttr{WindowsMinorVersion}
 \item \AdAttr{WindowsBuildNumber}
 \end{itemize}
For definitions, please see 
the unnumbered subsection labeled Machine ClassAd Attributes
on page~\pageref{sec:Machine-ClassAd-Attributes}.

\item Added new authorization levels to allow fine-grained control
over the security settings that are used by the collector when
receiving ClassAd updates by different types of daemons:
\DCPerm{ADVERTISE\_MASTER}, \DCPerm{ADVERTISE\_STARTD}, and
\DCPerm{ADVERTISE\_SCHEDD}.  An example of what you can do with this
is to require that all \Condor{startds} that join the pool be
authenticated with a pool password and exist within a restricted set
of IP addresses, while schedds may join the pool from a broader set
of IP addresses and must authenticate with X509 credentials.

\item Added ability to throttle in Condor's file transfer mechanism
the maximum number of simultaneous stage-outs and stage-ins for jobs
submitted from the same \Condor{schedd}.  The configuration variables
are \MacroNI{MAX\_CONCURRENT\_DOWNLOADS} and
\MacroNI{MAX\_CONCURRENT\_UPLOADS}.  The default is 10 simultaneous
uploads of input files and 10 simultaneous downloads of output files.
These limits currently do not apply to grid universe jobs or standard
universe jobs.

\item Added \MacroNI{SCHEDD\_QUERY\_WORKERS}, which is 3 by default in
Unix, and which is ignored in Windows.  This specifies the maximum
number of concurrent sub-processes that the \Condor{schedd} will spawn
to handle queries.

\item Condor-C now uses a more efficient protocol when querying the
status of jobs from Condor 6.9.5 and newer \Condor{schedd} daemons.

\item Added 4 new counters to the job ClassAd:
 \begin{itemize}
 \item \AdAttr{NumJobStarts}
 \item \AdAttr{NumJobReconnects}
 \item \AdAttr{NumShadowExceptions}
 \item \AdAttr{NumShadowStarts}
 \end{itemize}
For more information, please see their descriptions in
section~\ref{sec:Job-ClassAd-Attributes} on page~\pageref{sec:Job-ClassAd-Attributes}.

\item Added a new attribute, \AdAttr{GridJobStatus}, to the ClassAds of
\SubmitCmd{grid} universe jobs. This string shows the job's status as reported
by the remote job management system.

\item \Condor{q} \Opt{-analyze} now shows the full hold reason for jobs
that are on hold.

\item Increased efficiency of \Condor{preen} when there are large
numbers of jobs in the job queue.  Without this, the \Condor{schedd}
would become unresponsive for a long time (e.g. 10 minutes with 20,000
jobs in the queue) whenever \Condor{preen} was activated.

\item A 6.9.5 \Condor{q} can now query an older \Condor{quill} daemon directly 
for job information.

\item Reduced memory requirements of \Condor{shadow}.

\item Added the ability to \Condor{submit} to list unused or unexpanded 
  variables in submission file.

% Gnats PR 372.
\item Added the capability to assign priorities to DAG nodes.  Ready nodes
within a DAG are submitted in priority order by \Condor{dagman}.

% Gnats PR 852
\item Added the capability to assign categories to DAG nodes, and
throttle submission of node jobs by category.

\item \MacroNI{USE\_CLONE\_TO\_CREATE\_PROCESSES} (which defaults to
True) is now supported on ppc64, SUSE 9.  This also fixes a bug in which
the Yellow Dog Linux version of Condor installed on a ppc64 SUSE 9 machine
would fail to start jobs.

\item When the \Condor{preen} sends email about old files being found, it
now includes the name of the machine and the number of files found in the
subject of the message.

\item The user log reading code is now able to handle global event log
  rotations correctly.  The API is backwards compatible, but with
  several new method, it is able to invisibly handle rotated event log
  files.

\item The user log writer code now generates a header record (as a
  ``generic'' event) with some meta information to the event log.
  This header is not written to the ``user log'', only to the global
  event log.  Some of the information stored in this header is used by
  the enhanced log reader (see above) to more reliably detect rotated
  log files.

\item The Grid Monitor now refrains from polling the status of jobs that
it has learned are done.

\item For grid-type condor jobs, the \Condor{gridmanager} is now more
efficient when querying the status of jobs on the remote \Condor{schedd}
when there are jobs with different X509 subjects.

\item URLs can now be given for the input and output files of grid-type
nordugrid jobs in the grid universe. URLs are forwarded to the NorduGrid
server, which performs the transfers.

\item The length of the paths to the job's initial working directory,
user log, and input/output files are no longer limited to 255
characters.  Previously, \Condor{submit} would refuse to accept jobs
exceeding this POSIX\_PATH\_MAX limit.  Now the only limit is whatever
limit the operating system enforces on the system where the files are accessed.

\item The \Condor{startd} now receives updates to the job ClassAd from
the \Condor{starter}.  The primary benefit of this is that
\AdAttr{DiskUsage} is updated and can therefore be used in policy
expressions, such as \MacroNI{PREEMPT}.  The frequency of updates is
determined by \MacroNI{STARTER\_UPDATE\_INTERVAL}.

\item Several improvements have been made to Condor's ability to run
using privilege separation on the execute side. See section~\ref{sec:PrivSep}
for details.

\item Added support on Linux systems for reliably tracking all of a job's
processes using a dedicated supplementary group ID. This has the advantage
of working regardless of whether a job runs using a dedicated user account.
See section~\ref{sec:GroupTracking} for details.

\end{itemize}

\noindent Configuration Variable Additions and Changes:

\begin{itemize}

\item The new variables \Macro{MAX\_CONCURRENT\_DOWNLOADS} and
\Macro{MAX\_CONCURRENT\_UPLOADS} limit the number of simultaneous file
transfers that may take place through Condor's file transfer mechanism
for jobs submitted to the same \Condor{schedd}.  The default is 10
simultaneous uploads of input files and 10 simultaneous downloads of
output files.  These limits currently do not apply to grid universe
jobs or standard universe jobs.  See
page~\pageref{param:MaxConcurrentDownloads} for more information.

\item The default for \Macro{JOB\_START\_DELAY} has been changed
from 2 seconds to 0.  This means the \Condor{schedd} will not limit
the rate at which it starts up \Condor{shadow} processes by default.
The delay between startup of jobs may now be controlled individually
for jobs using the job attribute \AdAttr{NextJobStartDelay}, which
defaults to 0 seconds and is at most \Macro{MAX\_NEXT\_JOB\_START\_DELAY},
which defaults to 10 minutes.

\item The new variable \MacroNI{SCHEDD\_QUERY\_WORKERS} specifies the
maximum number of concurrent sub-processes that the \Condor{schedd}
will spawn to handle queries.  This is ignored in Windows.  In Unix,
the default is 3.  See page~\pageref{param:ScheddQueryWorkers} for
more details.

\item The new variable \Macro{WANT\_UDP\_COMMAND\_SOCKET} controls
  if Condor daemons should create a UDP command socket in addition to
  the TCP command socket (which is required).
  The default is \Expr{True}, but it is now possible to completely
  disable UDP command sockets by defining this to \Expr{False}.
  See section~\ref{param:WantUDPCommandSocket} on
  page~\pageref{param:WantUDPCommandSocket} for more information.

\item The new variable \Macro{NEGOTIATOR\_INFORM\_STARTD} controls if
  the \Condor{negotiator} should inform the \Condor{startd} when it
  has been matched with a job.
  The default is \Expr{True}.
  See section~\ref{param:NegotiatorInformStartd} on
  page~\pageref{param:NegotiatorInformStartd} for more information.

\item The new variable \Macro{SHADOW\_LAZY\_QUEUE\_UPDATE} controls if
  the \Condor{shadow} should immediately update the job queue for
  certain attributes (for example, the new \AdAttr{NumJobStarts} and
  \AdAttr{NumJobReconnects} counters) or if it should wait and only
  update the job queue on the next periodic update.
  The default is \Expr{True} to do lazy, periodic updates.
  See section~\ref{param:ShadowLazyQueueUpdate} on
  page~\pageref{param:ShadowLazyQueueUpdate} for more information.

\item The new variable \Macro{WARN\_ON\_UNUSED\_SUBMIT\_FILE\_MACROS} 
  controls if \Condor{submit} should warn when there are unused or
  unexpanded variables in a submit file.  The default is \Expr{True}
  to list unused or unexpanded variables.

\item \MacroNI{SCHEDD\_ROUND\_ATTR\_xxxx} can now take a value that is a
percentage, such as 25\%.  This causes the value for the attribute
\verb@<xxxx>@ to be rounded up to the specified percentage of its
closest order of magnitude.  For example, a setting of 25\% will cause
a value near 100 to be rounded up to the next multiple of 25 and a
value near 1000 will be rounded up to the next multiple of 250.  The
purpose of this rounding is to be able to better group similar jobs
together for negotiation purposes.  The configuration variables
\MacroNI{SCHEDD\_ROUND\_ATTR\_ImageSize},
\MacroNI{SCHEDD\_ROUND\_ATTR\_ExecutableSize}, and
\MacroNI{SCHEDD\_ROUND\_ATTR\_DiskUsage} now have a default value of
25\% rather than 4.  The result is that instead of rounding to 10MB
multiples, the rounding scales at roughly 25\% of the number being
rounded.

\item The default for \Macro{STARTER\_UPDATE\_INTERVAL} has been changed
from 20 minutes to 5 minutes.

\item The new parameters \Macro{PRIVSEP\_ENABLED} and
\Macro{PRIVSEP\_SWITCHBOARD} are required when setting up execute-side
Condor to use privilege separation. See section~\ref{sec:PrivSep} for
details.

\item The new parameters \Macro{USE\_GID\_PROCESS\_TRACKING},
\Macro{MIN\_TRACKING\_GID}, and \Macro{MAX\_TRACKING\_GID} are used
when setting up a Linux machine to use process tracking based on
dedicated supplementary group IDs. See section~\ref{sec:GroupTracking}
for details.

\end{itemize}

\noindent Bugs Fixed:

\begin{itemize}

\item Updated the SOAP API's \Code{enum UniverseType} to include all the 
      supported universes.

\item Missing files that Quill needed to function now appear in the
downloadable release of Condor.

\item When a \Condor{starter} discovered a missing username in the
process of discovering the owner of an executing job, a cryptic and
misleading error message was emitted to the daemon log. The error text
has been cleaned up to be more meaningful.

\item On Windows daylight saving is handled incorrectly by stat() and fstat().
      According to the MSDN, they both return the UTC time of a file; however,
      if daylight saving is detected, the time is adjusted by one hour, which 
      results in the \Condor{master} thinking that a different version of it 
      has been installed.  In which case it recycles itself, and it's child 
      process twice a year: not exactly what one would expect given that UTC
      time is not intended to pay attention to these regional changes.

\item When the master starts a collector on a central manager, the master
	now pauses for a short time before starting any other daemons. This
	helps the other daemons to appear in the collector more quickly. 

\item Patched the parallel universe scripts lamscript and mp1script
so that they work with newer versions of the GNU textutils.

\item Fixed a bad bug in the standard universe--introduced in Condor
6.9.4,  which would cause corruption of any binary data being written to
any fd the application opened. If an application only writes ASCII data
to an fd, the application will not encounter this bug.

\item Condor daemons will now print an error message in the logs when
\MacroNI{<SUBSYS>\_ATTRS} contains attributes that are not valid
ClassAd values.  Previously, this was a silent error.  The most common
reason for this problem is an unquoted string value.

\item The \Condor{negotiator} now prints out the value of the configuration
	parameter \MacroNI{PREEMPTION\_REQUIREMENTS} if it is set.  Previously,
	it always logged that it was unset, even when it was.

\item Fixed bug in the master that occurred if the collector
	was configured to use an ephemeral command port 
	(i.e. by explicitly setting the port to 0).	  The collector
	is now more reliable in this situation.

\item Standard universe jobs are no longer restricted in the length of
file names that may be passed to system calls within the program.
Previously, file names approaching 255 characters or more could
cause the program to crash or behave incorrectly.

\item Fixed a long-standing bug causing \Condor{submit} to fail when
given a requirements expression longer than 2048 characters.

\item Fixed a bug introduced in Condor 6.9.4 that caused grid universe
jobs of type gt4 to not work when the Condor daemons were started as
root and any file transfer was associated with the job.

\item Fixed a bug introduced in Condor 6.9.4 that caused the
\Condor{gridmanager} to exit immediately on startup when the Condor
daemons were started as root and a condor username didn't exist.

\item Removed race condition that was causing the \Condor{schedd} to core
  dump on Windows when the Condor service was stopped.

\item When grid universe jobs of grid-type condor, lsf, or pbs are running,
\Condor{q} will now show the correct accumulated runtime.

\item When removing grid universe jobs of type gt2 that have just finished
executing, the chance of encountering Globus GRAM error 31 (the job manager
failed to cancel the job as requested) is now much reduced.

\item Fixed a problem introduced in 6.9.4: the \Condor{schedd} would hang
when given a constraint with \Condor{hold} that included jobs that the user
did not have permission to modify.

\item Fixed a problem from 6.9.4 in which the schedd would not
relinquish a claimed startd after reconnecting to a disconnected job.
After the job finished, the startd would remain in the claimed idle
state until the claim lease expired (20 minutes by default).

\item Applied the \MacroNI{QUERY\_TIMEOUT} to fix problem where the schedd 
would block for a long time when doing negotiation with flocked or HAD 
negotiator, and one of the collectors was not routable (for instance, when 
the machine is powered off). Previously, there was no time-out and would
result in a the schedd waiting for the connection attempt to fail, which may
take a long time.

\item If both \MacroNI{EXECUTE\_LOGIN\_IS\_DEDICATED} and
\MacroNI{DEDICATED\_EXECUTE\_ACCOUNT\_REGEXP} are defined, the latter
now takes precedence, whereas previously the reverse was true.

\item Fixed a problem where if \Macro{STARTD\_RESOURCE\_PREFIX} was
set to anything besides \texttt{slot} (the default), all jobs would
run using the \Username{condor-reuse-slot1} (Windows) or
\MacroNI{SLOT1\_USER} account, regardless of the actual slot used for
execution. This problem existed in versions 6.9.3 and 6.9.4 of Condor.

\item Undocumented ``DAGMan helper'' functionality has been removed
  due to disuse

\item Reworked Condor's detection of CPUs and ``Hyper Threads'' under
  Linux.  It now correctly detects these on all machines that we've
  been able to test against.  No configuration changes are involved in
  this fix.

% Gnats PR 668
\item When a standard universe job becomes held due to user job policy or
a version mismatch, a hold reason is now set in the job ad.

\item Invalid \MacroNI{QUILL\_DB\_TYPE} settings could result in a 
segmentation fault in \Condor{q}. 
Condor now ignores invalid settings and assumes \Prog{PostgreSQL}.

\item In rare cases, \Condor{reconfig} could cause \Condor{master} and
one of its children to become deadlocked.  This problem was only
possible with security negotiation enabled, and it has therefore
existed in all versions of Condor since security negotiation was
added.

\item Fixed a potential crash in the \Condor{starter} if it's told to
shutdown while it's disconnected from the \Condor{shadow}.

\item Fixed the global event log rotation code.  Previously, if two or
  more processes were concurrently writing to the event log, they
  didn't correctly detect that another writer process had rotated the
  file, and would do their own rotation, resulting in data loss.

\item Fixed a bug in the \Condor{schedd} that could cause it to not match
any jobs for long periods of time.

\item Fixed potential crash when GCB was turned on.

\item Removed spurious attempts to open file
/home/condor/execute/dir\_\#\#\#\#\#/userdir/externals/install/globus-4.0.5/cert.pem
when SSL authentication is enabled.

\item Fixed problem where local universe jobs could leave stray processes behind
after termination.

\item Fixed a memory leak that affected all daemons receiving ClassAds via the
network if encryption were enabled. This bug existed in versions 6.9.3 and 6.9.4.

\item On Windows, fixed a problem that could cause spurious failures with Condor-C
or with streaming a job's standard output or error.
 
\end{itemize}

\noindent Known Bugs:

\begin{itemize}

\item Condor on MacOSX 10.4 on the PowerPC architecture.
will report zero image size and resident set size for jobs. This
is due to bugs in the MacOSX 10.4 kernel on the PowerPC.

\item There are some known vulnerabilities in the Virtual Machine
  (VM) universe support included in this release that can allow VM
  universe jobs to read arbitrary files on the host machine.
  VM universe is disabled by default, so this potential vulnerability
  does not affect most sites.
  However, VM universe should not be enabled unless the job policy
  only allows users that you trust completely to run jobs on the
  machine.

\item The \Condor{startd} will crash if \MacroNI{ENABLE\_BACKFILL} is
set to True.  This was also the case in 6.9.4.

\item The pool password authentication method fails to authenticate
(and in fact will cause the client to crash).

% PR 906
\item If \Condor{dagman} cannot execute a PRE or POST script
(for example, if the script name is specified incorrectly),
\Condor{dagman} will hang indefinitely.  (Note that if the 
script is executed and fails, \Condor{dagman} deals with this
correctly.)  (This bug was fixed in version 6.8.7.)


\end{itemize}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{\label{sec:New-6-9-4}Version 6.9.4}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\noindent Release Notes:

\begin{itemize}

\item The default in standard universe for \SubmitCmd{copy\_to\_spool}
is now \Expr{true}.  In 6.9.3, it was changed to \Expr{false} for all
universes for performance reasons, but this is deemed too risky for
standard universe, because any modification of the executable is
likely to make it impossible to resume execution using checkpoint
files made from the original version of the executable.

\item Version 1.5.0 of the Generic Connection Broker (GCB) is
  now used for building Condor.
  This version of GCB fixes a few critical bugs.
  \begin{itemize}
    \item GCB was unable to pass information about sockets registered
      at a GCB broker to child processes due to a bug in the way a
      special environment variable was being set.
    \item All sockets for outbound connections were being registered
      at the GCB broker, which was putting severe strain on the GCB
      broker even under relatively low load.
      Now, only sockets that are listening for inbound connections are
      registered at the broker.
    \item The \Macro{USE\_CLONE\_TO\_CREATE\_PROCESSES} setting was
      causing havoc for applications linked with GCB.
      This configuration setting is now always disabled if GCB is enabled.
    \item Fixed a race condition in GCB\_connect() that would
      frequently cause connect() attempts to fail, especially
      non-blocking connections.
    \item Fixed bugs in GCB\_select() when GCB changes the direction
      of a connection from active to passive (for example, so that a
      Condor daemon running behind a firewall will use an outbound
      connection to communicate with a public client that had
      attempted to initiate contact via the GCB broker).
    \item Also improved logging at the GCB broker.
  \end{itemize}

  Additionally, there was a bug in how Condor was publishing the
  classified ads for GCB-enabled daemons.
  Condor used to be re-writing any attributes containing an IP address
  when a classified ad was sent over a network connection (in an
  effort to provide correct behavior for multi-homed machines).
  Now, this re-writing is disabled whenever GCB is enabled, since GCB
  already has logic to determine the correct IP addresses to advertise.

  For more information about GCB, see section~\ref{sec:GCB} on
  page~\pageref{sec:GCB}. 

\item The owner of the log file for the \Condor{gridmanager}
  has changed to the \Login{condor} user.
  In Condor 6.9.3 and previous versions, it was owned by the
  user submitting the job.
  Therefore, the owner of and permissions on an existing log file 
  are likely to be incorrect.
  Condor issues an error if the \Condor{gridmanager} is unable
  to read and write the existing file.
  To correct the problem, an administrator may modify file 
  permissions such that the \Login{condor} user may read and
  write the log file. 
  Alternatively, an administrator may delete the file, and
  Condor will create a new file with the expected owner and
  permissions.
  In addition, the definition for \Macro{GRIDMANAGER\_LOG}
  in the \File{condor\_config.generic} file has changed for
  Condor 6.9.4.

\end{itemize}


\noindent New Features:

\begin{itemize}

\item Condor has been ported to Yellow Dog 5.0 Linux on the
PPC architecture. This port of Condor will also run on the
Sony Playstation 3 running said distribution of Linux.

\item Enhanced the standard universe to utilize Condor's privilege separation
mechanism.

\item Implemented a completely new version of Quill.  Quill can now
record information about all the daemons into a relational database.
See section~\ref{sec:Quill} for details on Quill.

\item Jobs in the mpi universe now can have \$\$ expanded in their
ads in the same way as other universes.

\item Added the \SubmitCmd{vm} universe, to facilitate
running jobs under Xen or VMware virtual machines.

\item Added the \Opt{-subsystem} command to \Condor{status} that queries all
ClassAds of a given type.

\item Improved the speed at which the \Condor{schedd} writes to its database
file \File{job\_queue.log} and the job history file.  In benchmark tests,
this roughly doubles the maximum throughput rate to approximately 
20 jobs per second, although actual
performance depends on the specific hardware used.

\item The \Condor{startd} now records historical statistics about the
  total time (in seconds) that it spends in every state/activity pair.
  If a given slot spent more than 0 seconds in any of the possible
  pairs, the specifically-named ClassAd attribute for that
  pair is defined in the slot's ClassAd.
  The list of possible new machine attributes (alphabetically):
\begin{verbatim}
TotalTimeBackfillBusy
TotalTimeBackfillIdle
TotalTimeBackfillKilling
TotalTimeClaimedBusy
TotalTimeClaimedIdle
TotalTimeClaimedRetiring
TotalTimeClaimedSuspended
TotalTimeMatchedIdle
TotalTimeOwnerIdle
TotalTimePreemptingKilling
TotalTimePreemptingVacating
TotalTimeUnclaimedBenchmarking
TotalTimeUnclaimedIdle
\end{verbatim}

\item The \Condor{shadow} now waits and retries after failing to
commit the final update to the job ClassAd in the \Condor{schedd}'s
job queue, rather than immediately aborting and causing the job to be
requeued to run again.  See
page~\pageref{param:ShadowMaxJobCleanupRetries} for the related
configuration options.

\item If the \Condor{starter} fails with a core dump on Unix, the
core dump file is now put in the LOG directory.  Previously, it
was deleted by the \Condor{startd}.

\item Added a small amount of randomization to the default values of
\MacroNI{PERIODIC\_CHECKPOINT} (in the example config file) and
\MacroNI{PASSWD\_CACHE\_REFRESH} (in Condor's internal default) in
order to decreases the chances of synchronized timing across many
processes causing overloading of servers.

\item Added the new submit command \SubmitCmd{cron\_window}. It is an alias
to \SubmitCmd{deferral\_window}.

\item Optimized the submission of grid-type gt4 grid universe jobs to the
remote resource.Submission now takes one operation instead of three.

\item Added new functionality for multi-homed machines (those with
  multiple network interfaces) to allow Condor to handle private
  networks in some cases without having to use the Generic Connection
  Broker (GCB).
  See the entries below that describe the new
  \MacroNI{PRIVATE\_NETWORK\_NAME} and
  \MacroNI{PRIVATE\_NETWORK\_INTERFACE} configuration variables.

\end{itemize}

\noindent Configuration Variable Additions and Changes:

\begin{itemize}

\item Added \MacroNI{SLOT<N>\_EXECUTE}.  This allows the execute directory
to be configured independently for each batch slot.  You could use this,
for example, to have jobs on a multi-CPU machine using scratch space on
different disks so that there is less chance of them interfering with
each other.  See page~\pageref{param:SlotNExecute} for more details.

\item The semantics of \MacroNI{SLOT\_TYPE\_<N>} has changed slightly.
Previously, any resource shares left undefined would default to a fractional
share equal to \Expr{1/NUM\_CPUS}.  Now, the default is \Expr{auto}, which
causes all remaining resources to be evenly divided.  This is more convenient
in cases where some slots are configured to take more or less than their
``fair'' share and the rest are desired to evenly split the remainder.
The underlying reason for this change was to be able to better support
the specification of disk partition shares in all the possible cases:
The \Expr{auto} share takes into account how many slots are sharing the
same disk partition.

\item When set to \Expr{True}, the new configuration variable
\Macro{LOGS\_USE\_TIMESTAMP} will cause Condor to print all daemon
log messages using a Unix timestamp instead of a formatted date
string. This feature is useful for debugging Condor Glideins that may
be executing in different timezones. It should be noted that this does
not affect job user logs. The default is \Expr{False}.

\item The existing configuration variable \Macro{LOG\_ON\_NFS\_IS\_ERROR} has 
changed behavior. When set to \Expr{False},
\Condor{submit} does not emit a warning about user logs files being on NFS.

% Gnat PR 652
\item The existing 
configuration variables \Macro{DAEMON\_LIST},
\Macro{DC\_DAEMON\_LIST}, and \Macro{MASTER\_HA\_LIST} 
have changed behavior.
Trailing commas are now ignored.
Previously, trailing commas could cause the \Condor{master} to misbehave,
including exiting with an error.

\item The \Macro{<SUBSYS>\_DAEMON\_AD\_FILE} was defined for the \Condor{schedd}.
This setting was first made available in Condor 6.9.1 but was not used for
any daemon.  
It appears in the configuration file as \Macro{SCHEDD\_DAEMON\_AD\_FILE} and
is set to the file .schedd\_classad in the LOG directory. This setting is 
not necessary unless you are using the Quill functionality, and pools may 
upgrade to 6.9.4 without setting it if they are not using Quill. 
  
\item Added new configuration variables
\Macro{DBMSD}, \Macro{DBMSD\_ARGS}, and \Macro{DBMSD\_LOG},
which define the location of the \Condor{dbmsd} daemon,
the command line arguments to that daemon,
and the location of the daemon's log.
Default values are
\begin{verbatim}
DBMSD = $(SBIN)/condor_dbmsd
DBMSD_ARGS = -f
DBMSD_LOG = $(LOG)/DbmsdLog
\end{verbatim}
These configuration variables are only necessary when using Quill,
and then must be defined on only one machine in the Condor pool.

\item Added new configuration variables
\Macro{PRIVATE\_NETWORK\_NAME} and
\Macro{PRIVATE\_NETWORK\_INTERFACE},
which allow Condor daemons to function more properly on multi-homed
machines and in certain network configurations that involve private
networks.
There are no default values, both must be explicitly defined to have
any effect.
See section~\ref{param:PrivateNetworkName} on
page~\pageref{param:PrivateNetworkName} for more information about
these two new settings.

\item Added new configuration variables
  \Macro{EVENT\_LOG}, \Macro{MAX\_EVENT\_LOG}, \Macro{EVENT\_LOG\_USE\_XML}, 
  and \Macro{EVENT\_LOG\_JOB\_AD\_INFORMATION\_ATTRS}
  to specify the new event log which logs job user log events,
  but across all users.
  See section~\ref{param:EventLog} on
  page~\pageref{param:EventLog} for definitions of these configuration
  variables.
\end{itemize}


\noindent Bugs Fixed:

\begin{itemize}

\item Trailing commas in lists of items in submit files and 
configuration files are now ignored.  Previously, Condor would treat trailing
commas in various surprising ways.

\item Numerous bugs in GCB and the interaction between Condor and GCB.
  See the release notes above for details.

\item The submit file entry ``coresize'' was not being honored properly on
many universe. It is now honored on all universes except pvm and the grid
universes (except where the grid type is Condor). For the java universe,
it controls the core file size for the JVM itself.

\item The \Condor{configure} installation script now allows Condor
to be installed on hosts without a fully-qualified domain name.

% Gnats PR 857/condor-admin 15687
\item Fixed a bug in \Condor{dagman}: if a DAG run with a per-DAG
configuration file specification generated a rescue DAG, the rescue
DAG file did not contain the appropriate DAG configuration file line.
(This bug was introduced when the per-DAG configuration file option
was added in version 6.9.2.)

\item Fixed a bug introduced in 6.9.3 when handling local universe jobs.
The starter ignored failures in contacting the \Condor{schedd} in the
final update to the job queue.

\item When the \Condor{schedd} is issued a graceful shutdown command, any jobs
that running with a job lease are allowed to keep running. When the \Condor{schedd}
starts back up at a later time, it will spawn \Condor{shadow} to reconnect
to the jobs if they are still executing. This mimics the same behavior as
a fast shutdown.  This also fixes a bug in 6.9.3 in which the \Condor{schedd}
would fail to reconnect to jobs that were left running during a graceful
shutdown.

\item When the \Condor{starter} is gracefully shutting down and if it
has become disconnected from the \Condor{shadow}, it will wait for the
job lease time to expire before giving up on telling the \Condor{shadow}
that the job was evicted.  Previously, the \Condor{starter} would exit
as soon as it was done evicting the job.

% Gnat PR 718
\item Job ad attribute \Attr{HoldReasonCode} is now properly set when
\Condor{hold} is called and when jobs are submitted on hold.

\item If a job specified a job lease duration, and the \Condor{schedd}
  was killed or crashed, the \Condor{shadow} used to notice when the
  \Condor{schedd} was gone, and gracefully shutdown the job (evicting
  the job at the remote site).
  Now, the \Condor{shadow} honors the job lease duration, and if the
  lease has not yet expired, it simply exists without evicting the
  job, in the hopes that the \Condor{schedd} will be restarted in time
  to reconnect to the still-running job and resume computation.

\item Fixed a bug from 6.9.3 in which \Condor{q} \Opt{-format} no longer
worked when given an expression (as opposed to simple attribute reference).
The expression was always treated as being undefined.

\item When a condor daemon such as the \Condor{schedd} or
\Condor{negotiator} tried to establish many new security sessions for
UDP messages in a short span of time, it was possible for the daemon
to run out of file descriptors, causing it to abort execution and be
restarted by the \Condor{master}.  A problem was found and fixed in the
mechanism that protects against this.

\item Improved error descriptions when Condor-C encounters failures when
sending input files to the remote schedd.

\item Rare failure conditions during stage in would cause Condor-C to put
the state of the job in the remote schedd into an invalid state in which
it would run but later fail during stage out.  This now results in the
job on the submit side going on hold with a staging failure.

\item Fixed a bug which could cause \Condor{store\_cred} to crash during
common use.

\item Fixed a bug where the vanilla universe \Condor{starter} would possibly
crash when running a job not as the owner of the job.

\item Fixed a bug which would cause a \Condor{starter} being used for
the local universe to core dump.

\item Fixed a bug which caused the \Condor{schedd} to core dump while
processing a job's crontab entries in the submit description file.

\item Fixed a privilege separation bug in the standard universe 
\Condor{starter}.

\end{itemize}

\noindent Known Bugs:

\begin{itemize}

\item \SubmitCmd{standard} universe jobs do not work
  when writing binary data.  The behavior exhibited in this
  case may include the job crashing, or corrupt binary written.

\item \SubmitCmd{grid} universe jobs for the gt4 grid type do not work, 
if Condor daemons are started as root
and there is file transfer associated with or specified by the job.
These jobs are placed on hold.

\item The \Macro{STARTD\_RESOURCE\_PREFIX} setting on Windows results
in broken behavior on both Condor 6.9.3 and 6.9.4. Specifically, when
this setting is given a value other than its default (``slot''), all
jobs will run using the ``condor-reuse-slot1'' user account,
regardless of the actual slot used for execution.

\end{itemize}

\noindent Additions and Changes to the Manual:

\begin{itemize}

\item New documentation for the new \SubmitCmd{vm} universe
in the User's Manual, section~\ref{sec:vmuniverse}.
Definitions of configuration variables for the \SubmitCmd{vm} universe are in
section~\ref{sec:Config-VMs}.

\item New RDBMS schema tables added for Quill in
section~\ref{sec:Quill-Schema}.

\item ClassAd attribute definitions reside in a new appendix.
In addition to machine and job attributes, DaemonMaster and Scheduler
attributes are included.
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{\label{sec:New-6-9-3}Version 6.9.3}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\noindent Release Notes:

\begin{itemize}

\item As of version 6.9.3, the entire Condor system has undergone a
  major terminology change.
  For almost 10 years, Condor has used the term \Term{virtual machine}
  or \Term{vm} to refer to each distinct resource that could run a
  Condor job (for example, each of the CPUs on an SMP machine).
  Back when we chose this terminology, it made sense, since each of
  these resource was like an independent machine in a pool, with
  its own state, ClassAd, claims, and so on.
  However, in recent years, the term \Term{virtual machine} is now
  almost universally associated with the kinds of virtual machines
  created using tools such as VMware and Xen.  Entire operating systems
  run inside a given process, usually emulating the underlying
  hardware on a host machine.
  So, to avoid confusion with these other kinds of virtual machines,
  the old  \Term{virtual machine} terminology has been replaced by
  the term \Term{slot}.

  Numerous configuration settings, command-line arguments to Condor
  tools, ClassAd attribute names, and so on, have all been
  modified to reflect the new \Term{slot} terminology.
  In general, the old settings and options will still work, but are
  now retired and may disappear in the future.

\item The \Condor{install} installation script has
  been removed.
  All sites should use \Condor{configure} when setting up a new Condor
  installation.

\item The \Macro{SECONDARY\_COLLECTOR\_LIST} configuration variable has
  been removed.
  Sites relying on this variable should instead use the configuration
  variable \Macro{COLLECTOR\_HOST}. It may be used to
  define a list of \Condor{collector} daemon hosts.

\item Cleaned up and improved help information for \Condor{history}.

\end{itemize}


\noindent New Features:

\begin{itemize}

\item Numerous scalability and performance improvements.  Given enough
memory, the schedd can now handle much larger job queues (e.g. 10s of
thousands) without the severe degradation in performance that used to
be the case.

\item Added the \Macro{START\_LOCAL\_UNIVERSE} and \Macro{START\_SCHEDULER\_UNIVERSE}
parameters for the \Condor{schedd}. This allows administrators to control whether
a Local/Scheduler universe job will be started. This expression is evaluated
against the job's ClassAd before the \AdAttr{Requirements} expression.

\item All Local and Scheduler universe jobs now have their \AdAttr{Requirements} 
expressions evaluated before execution. If the expression evaluates to false, the
job will not be allowed to begin running. In previous versions of Condor, Local 
and Scheduler universe jobs could begin execution without the \Condor{schedd} checking
the validity of the \AdAttr{Requirements}.

\item Added \MacroNI{SCHEDD\_INTERVAL\_TIMESLICE} and
\MacroNI{PERIODIC\_EXPR\_TIMESLICE}.  These indicate the maximum
fraction of time that the schedd will spend on the respective
activities.  Previously, these activities were done on a fixed
interval, so with very large job queue sizes, the fraction of time
spent was increasing to unreasonable levels.

\item Under Intel Linux, added \Macro{USE\_CLONE\_TO\_CREATE\_PROCESSES}.
This defaults to true and results in scalability improvements for processes
using large amounts of memory (e.g. a schedd with a lot of jobs in the queue).

\item Jobs in the parallel universe now can have \$\$ expanded in their
ads in the same way as other universes.

\item Local universe jobs now support policy expression evaluation, which includes
the \AdAttr{ON\_EXIT\_REMOVE}, \AdAttr{ON\_EXIT\_HOLD}, \AdAttr{PERIODIC\_REMOVE},
\AdAttr{PERIODIC\_HOLD}, and \AdAttr{PERIODIC\_RELEASE} attributes. The periodic
expressions are evaluated at intervals determined by the
\Macro{PERIODIC\_EXPR\_INTERVAL} configuration macro.

\item Jobs can be scheduled to executed periodically, similar to the crontab
functionality found in Unix systems. The \Condor{schedd} calculates the next
runtime for a job based on the new \AdAttr{CRON\_MINUTE}, \AdAttr{CRON\_HOUR},
\AdAttr{CRON\_DAY\_OF\_MONTH}, \AdAttr{CRON\_MONTH}, and
\AdAttr{CRON\_DAY\_OF\_WEEK} attributes. A preparation time defined by the
\AdAttr{CRON\_PREP\_TIME} attribute allows a job to be submitted to the
execution machine before the actual time the job is to begin execution.
Jobs that would like to be run repeatedly will need to define the
the \AdAttr{ON\_EXIT\_REMOVE} attribute properly so that they are
re-queued after executing each time.

\item Condor now looks for its configuration file in \File{/usr/local/etc}
if the \Macro{CONDOR\_CONFIG} environment variable is not set and there is
no condor\_config file located in \File{/etc/condor}. This allows a default
Condor installation to be more compatible with Free BSD.

\item If a user job requests streaming input or output in the submit
file, the job can now run with job leases and the job will continue
to run for the lease duration should the submit machine crash.  Previously,
jobs with streaming i/o would be evicted if the submit machine crashed.
While the submit machine is down, if the job tried to issue a streaming
read or write, the job will block until the submit machine returns or the
job lease expires.

\item Ever since version 6.7.19, \Condor{submit} has added a default
  job lease duration of 20 minutes to all jobs that support these
  leases.
  However, there was no way to disable this functionality if a user
  did not want job lease semantics.
  Now, a user can place \verb@job_lease_duration = 0@ in their submit
  file to manually disable the job lease.

% condor-admin 15254
\item Added new configuration knob \Macro{STARTER\_UPLOAD\_TIMEOUT}
which sets the timeout for the \Condor{starter} to upload output files to the
\Condor{shadow} on job exit.  The default value is 200 seconds, which should
be sufficient for serial jobs.  For parallel jobs, this may need to
be increased if many large output files are sent back to the shadow
on job exit.

% Gnats PR 806
\item \Condor{dagman} now aborts the DAG on ``scary'' submit events.
These are submit events in which
the Condor ID of the event does not match the
expected value.
Previously, \Condor{dagman} printed a warning, but continued.
To restore Condor to the previous behavior,
set the new \Macro{DAGMAN\_ABORT\_ON\_SCARY\_SUBMIT} configuration variable
to \Expr{False}.

\item When the \Condor{master} detects that its GCB broker is unavailable
and there is a list of alternative brokers,
it will restart immediately if \Macro{MASTER\_WAITS\_FOR\_GCB\_BROKER} is
set to \Expr{False} instead of waiting for another broker to became available.
\Condor{glidein} now sets \MacroNI{MASTER\_WAITS\_FOR\_GCB\_BROKER}
to  \Expr{False} in its configuration file.

\item When using GCB and a list of brokers is available, the
\Condor{master} will now pick a random broker rather than the least-loaded
one.

\item All Condor daemons now evaluate some ClassAd expressions
  whenever they are about to publish an update to the
  \Condor{collector}.
  Currently, the two supported expressions are:
  \begin{description}
  \item[\Macro{DAEMON\_SHUTDOWN}]
    If \Expr{True}, the daemon will gracefully shut itself down and will not
    be restarted by the \Condor{master} (as if it sent itself a
    \Condor{off} command).
  \item[\Macro{DAEMON\_SHUTDOWN\_FAST}]
    If \Expr{True}, the daemon will quickly shut itself down and will not be
    restarted by the \Condor{master} (as if it sent itself a
    \Condor{off} command using the \Opt{-fast} option).
  \end{description}
  For more information about these expressions, see
  section~\ref{param:DaemonShutdown} on
  page~\pageref{param:DaemonShutdown}.

\item When the \Condor{master} sends email announcing that another daemon has
died, exited, or been killed, it now notes the name of the machine, the
daemon's name, and a summary of the situation in the Subject line.

\item Anyplace in a Condor configuration or submit description file where
wild cards may be used, you can now place wild cards at both the beginning
and end of the string pattern (i.e. match strings that contain the text
between the wild cards anywhere in the string). Previously, only one
wild card could appear in the string pattern.

\item Added optional configuration setting
\Macro{NEGOTIATOR\_MATCH\_EXPRS}.  This allows the negotiator to
insert expressions into the matched ClassAd.  See
page~\pageref{param:NegotiatorMatchExprs} for more information.

\item Increased speed of ClassAd parsing.

\item Added \Macro{DEDICATED\_EXECUTE\_ACCOUNT\_REGEXP} and
deprecated the boolean setting
\Macro{EXECUTE\_LOGIN\_IS\_DEDICATED}, because the latter could not
handle a policy where some jobs run as the job owner and some run as
dedicated execution accounts.  Also added support for
\Macro{STARTER\_ALLOW\_RUNAS\_OWNER} under Unix.  See
Section~\ref{param:DedicatedExecuteAccountRegexp} and
Section~\ref{sec:RunAsNobody} for more information.

\item All Condor daemons now publish a \Attr{MyCurrentTime} attribute
  which is the current local time at the time the update was generated
  and sent to the \Condor{collector}.
  This is in addition to the \Attr{LastHeardFrom} attribute which is
  inserted by the \Condor{collector} (the current local time at the
  collector when the update is received).

\item \Condor{history} now accepts partial command line
arguments.  For example, -constraint can be abbreviated -const.
This brings \Condor{history} in line with other Condor command
line tools.

\item \Condor{history} can now emit ClassAds formatted as XML with
the new -xml option.
This brings \Condor{history} more in line \Condor{q}.

\item The \verb@$$@ substitution macro syntax now supports the insertion
of literal \verb@$$@ characters through the use of \verb@$$(DOLLARDOLLAR)@.
Also, \verb@$$@ expansion is no longer recursive, so if the value being
substituted in place of a \verb@$$@ macro itself contains \verb@$$@ characters,
these are no longer interpreted as substitution macros but are instead
inserted literally.

\item When started as root on a Linux 64-bit x86 machine, Condor daemons will
now leave core files in the log directory when they crash.  This matches
Condor's behavior on most other Unix-like operating systems, including
32-bit x86 versions of Linux.
% Code: Google's coredumper library is now used on Linux x86-64.

\item The \Env{\_CONDOR\_SLOT} variable is now placed into the
  environment for jobs of all universes.
  This variable indicates what slot a given job is running on, and
  will have the same value as the \AdAttr{SlotID} from the machine
  classified ad where the job is running.
  The \Env{\_CONDOR\_SLOT} variable replaces the deprecated
  \Env{CONDOR\_VM} environment variable, which was only defined for
  standard universe jobs.

\item Added a \Macro{USE\_PROCD} configuration parameter. If this
parameter is set to true for a given daemon, the daemon will use the
\Condor{procd} program to monitor process families. If set to false,
the daemon will execute process family monitoring logic on its
own. The \Condor{procd} is more scalable and is also an essential
piece in the ongoing privilege separation effort. The disadvantage of
using the ProcD is that it is newer, less-hardened code.

\end{itemize}

\noindent Configuration Variable Additions and Changes:

\begin{itemize}

\item The \Macro{SECONDARY\_COLLECTOR\_LIST} configuration variable has
  been removed.
  Sites relying on this variable should instead use the configuration
  variable \Macro{COLLECTOR\_HOST} to
  define a list of \Condor{collector} daemon hosts.

\item Added new configuration variables \Macro{START\_LOCAL\_UNIVERSE}
  and \Macro{START\_SCHEDULER\_UNIVERSE} for the \Condor{schedd} daemon.
  These boolean expressions default to \Expr{True}.
  \MacroNI{START\_LOCAL\_UNIVERSE} is relevant only to local universe jobs.
  \MacroNI{START\_SCHEDULER\_UNIVERSE} is relevant only to scheduler 
  universe jobs.
  These new variables allow an administrator to define
  a \MacroNI{START} expression specific to these jobs. 
  The expression is evaluated
  against the job's ClassAd before the \AdAttr{Requirements} expression.

\item Added new configuration variables \Macro{SCHEDD\_INTERVAL\_TIMESLICE}
  and \Macro{PERIODIC\_EXPR\_TIMESLICE}.  These configuration variables
  address a scalability issue for very large job queues.
  Previously, the \Condor{schedd} daemon handled an activity related
  to counting jobs, as well as the activity related to evaluating
  periodic expressions for jobs at the fixed time interval of 5 minutes.
  With large job queues, the fraction of the \Condor{schedd} daemon
  execution time devoted to these two activities became excessive,
  such that it could be doing little else.
  The fixed time interval is now gone, and Condor calculates the amount
  of time spent on the two activities, using these new configuration
  variables to calculate an appropriate time interval.
  
  Each is a floating point value within the range
  (noninclusive) 0.0 to 1.0.
  Each determines the maximum fraction of the time interval that the 
  \Condor{schedd} daemon  will spend on the respective
  activity.
  \MacroNI{SCHEDD\_INTERVAL\_TIMESLICE} defaults to the value 0.05,
  such that the calculated time interval will be 20 * the amount
  of time spent on the counting jobs activity.
  \MacroNI{PERIODIC\_EXPR\_TIMESLICE} defaults to the value 0.01,
  such that the calculated time interval will be 100 * the amount
  of time spent on the periodic expression evaluation activity.

\item Added new configuration variable 
  \Macro{USE\_CLONE\_TO\_CREATE\_PROCESSES}, relevant only to the
  Intel Linux platform.  
  This boolean value defaults to \Expr{True}, and it results in scalability
  improvements for Condor processes using large amounts of memory.
  These processes may clone themselves instead of forking themselves.
  An example of the improvement occurs for a \Condor{schedd}
  daemon with a lot of jobs in the queue.

\item Added new configuration variable \Macro{STARTER\_UPLOAD\_TIMEOUT},
  which allows a configurable time (in seconds) for a timeout used by the 
  \Condor{starter}.
  The default value of 200 seconds replaces the previously hard coded
  value of 20 seconds.
  This timeout before job failure is to upload output files to the
  \Condor{shadow} upon job exit.
  The default value should be sufficient for serial jobs.
  For parallel jobs, it may need to
  be increased if there are many large output files.

\item Added new configuration variable \Macro{DAGMAN\_ABORT\_ON\_SCARY\_SUBMIT}.
  This boolean variable defaults to \Expr{True}, and causes
  \Condor{dagman} to abort the DAG on ``scary'' submit events.
  These are submit events in which
  the Condor ID of the event does not match the expected value.
  Previously, \Condor{dagman} printed a warning, but continued.
  To restore Condor to the previous behavior,
  set \MacroNI{DAGMAN\_ABORT\_ON\_SCARY\_SUBMIT} to \Expr{False}.

\item Added new configuration variable \Macro{NEGOTIATOR\_MATCH\_EXPRS}.
  It causes the \Condor{negotiator} to
  insert expressions into the matched ClassAd.  See
  page~\pageref{param:NegotiatorMatchExprs} for details.

\item Added new configuration variable
  \Macro{DEDICATED\_EXECUTE\_ACCOUNT\_REGEXP} to replace the retired 
  \Macro{EXECUTE\_LOGIN\_IS\_DEDICATED},
  because \MacroNI{EXECUTE\_LOGIN\_IS\_DEDICATED} could not
  handle a policy where some jobs run as the job owner and others run as
  dedicated execution accounts.  Also added support for
  the existing configuration variable
  \Macro{STARTER\_ALLOW\_RUNAS\_OWNER} under Unix.  See
  Section~\ref{param:DedicatedExecuteAccountRegexp} and
  Section~\ref{sec:RunAsNobody} for more information.

\item Added new configuration variable \Macro{USE\_PROCD}.
  This boolean variable defaults to \Expr{False} for the
  \Condor{master}, and \Expr{True} for all other daemons.
  When \Expr{True}, the daemon will use the
  \Condor{procd} program to monitor process families.
  When \Expr{False}, a daemon will execute process family
  monitoring logic on its own.
  The \Condor{procd} is more scalable and is also an essential
  piece in the ongoing privilege separation effort. The disadvantage of
  using the \Condor{procd} is that it is newer, less-hardened code.

\end{itemize}

\noindent Bugs Fixed:

\begin{itemize}

\item On Unix systems, Condor can now handle file descriptors larger than
FD\_SETSIZE when using the select system call. Previously, file descriptors
larger than FD\_SETSIZE would cause memory corruption and crashes.

\item When an update to the \Condor{collector} from the
\Condor{startd} is lost, it is possible for multiple claims to the
same resource to be handed out by the \Condor{negotiator}.  This is
still true.  What is fixed is that these multiple claims will not
result in mutual annihilation of the various attempts to use the
resource.  Instead, the first claim to be successfully requested will
proceed and the others will be rejected.

\item \Condor{glidein} was setting \Macro{PREEN\_INTERVAL}=0 in the default
configuration, but this is no longer a legal value, as of 6.9.2.

\item \Condor{glidein} was not setting necessary configuration parameters
for \Condor{procd} in the default glidein configuration.

\item In 6.9.2, Condor daemons crashed after failing to authenticate a
network connection.

\item \Condor{status} will now accurately report the \Attr{ActvtyTime}
  (activity time) value in Condor pools where not all machines are in
  the same timezone, or if there is clock-skew between the hosts.

\item Fixed the known issue in Condor 6.9.2 where using the
\Macro{EXECUTE\_LOGIN\_IS\_DEDICATED} setting on UNIX platforms would
cause the \Condor{procd} to crash.

\item Failure when activating a COD claim no longer will result in an
opportunistic job running on the same \Condor{startd} being left
suspended. This problem was most likely to be seen when using the
\Macro{GLEXEC\_STARTER} feature.

\item In Condor 6.9.2 for Tru64 UNIX, the \Condor{master} would
immediately fail if started as root. This problem has been fixed.

\item Condor 6.9.2 introduced a problem where the \Condor{master}
would fail if started as root with the UID part of the
\Macro{CONDOR\_IDS} parameter set to 0 (root). This issue has been
fixed.

\end{itemize}

\noindent Known Bugs:

\begin{itemize}

\item The 6.9.3 \Condor{schedd} daemon incorrectly handles jobs with leases
(true by default for vanilla, java, and parallel universe jobs) when
shutting down gracefully.  These jobs are allowed to continue running,
but when the \Condor{schedd} daemon is started back up, it fails to reconnect
to them.  The result is that the orphaned jobs are left running for
the duration of the job's lease time (a default time of 20 minutes).
The state of the jobs in the restarted queue is independent of any
orphaned running jobs, so these queued jobs may begin running on another
machine while orphans are still running.

\item \Condor{q} \Opt{-format} in 6.9.3 does not work with expressions.  It
behaves as if the expression evaluates to an undefined result.

\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{\label{sec:New-6-9-2}Version 6.9.2}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\noindent Release Notes:

\begin{itemize}

%% This is important (and thus, I believe, worth of being a top
%% level release note) because it will surprise anyone upgrading
%% an existing pool or repackaging Condor binaries (say, for
%% custom glideins, or as .deb packages for a local pool.)
% This is part of the privilege separation work, but the procd
% is required even if you're not turning privsep on.
% Questions should go to the privsep team: psilord, zmiller, etc.
\item As part of ongoing security enhancements, Condor now has a
new, required daemon: \Condor{procd}.  This daemon is
automatically started by the \Condor{master}, you do not need to
add it to \Macro{DAEMON\_LIST}.  
However, you must be certain to update the \Condor{master}
if you update any of the other Condor daemons.
%Commented out the below since the defaults are in the code.
%New installations should not
%need to do anything; the default configuration file is correctly
%set.  Installations upgrading to 6.9.2 from previous versions
%will need to ensure several things are done.  
%1. Be sure to install \Condor{procd} into your Condor \Macro{SBIN} directory. 
%2. Add ``\Code{PROCD = \$(SBIN)/condor\_procd}'' to your Condor configuration. 
%3. Add ``\Code{PROCD\_ADDRESS = \$(LOCK)/procd\_pipe}'' to your Condor configuration. 
%On Windows there are two additional steps:
%4. Be sure to install \Condor{softkill} into your Condor \Macro{SBIN} directory. 
%5. Add ``\Code{WINDOWS\_SOFTKILL = \$(SBIN)/condor\_softkill}'' to your Condor configuration. 

% This isn't quite so important, but it's not really a feature or
% a bug, just a change.  It is a change that may surprise some
% users.  The full list of settings impacted is
% pretty long.  So far the below is just a small fraction,
% primarily being added because an external user was surprised by
% this when testing a 6.9.2-prerelease. For anyone curious or
% inspired to flesh out the list, here's the checkin that caused
% this:
% http://bonsai.cs.wisc.edu/bonsai/cvsquery.cgi?who=danb&whotype=match&sortby=Date&date=explicit&mindate=02%2F23%2F2007+19%3A15&maxdate=02%2F23%2F2007+19%3A30
% (To do the search yourself, search for checkins by danb between
% 02/23/2007 19:15 and 02/23/2007 19:30 )
% To determine if a variable is impacted, look at the removed
% code and confirm that it used the default if the setting was 0.
% Then if the new code sets a minimum of 1 (the third argument to
% param_integer), it's impacted.
\item Some configuration settings that previously accepted 0 no
  longer do so.  Instead the daemon using the setting will exit
  with an error message listing the acceptable range to its log.
  For these settings 0 was equivalent to requesting the default.
  As this was undocumented and confusing behavior it is no longer
  present.  To request a setting use its default, either comment it
  out, or set it to nothing (``\Code{EXAMPLE\_SETTING=}'').
  Settings impacted include but are not limited to: 
  % From condor_master.V6/master.C 1.82 to 1.83:
  \Macro{MASTER\_BACKOFF\_CONSTANT},
  \Macro{MASTER\_BACKOFF\_CEILING},
  \Macro{MASTER\_RECOVER\_FACTOR},
  \Macro{MASTER\_UPDATE\_INTERVAL},
  \Macro{MASTER\_NEW\_BINARY\_DELAY},
  \Macro{PREEN\_INTERVAL},
  \Macro{SHUTDOWN\_FAST\_TIMEOUT},
  \Macro{SHUTDOWN\_GRACEFUL\_TIMEOUT},
  % From condor_master.V6/daemon.C 1.68 to 1.69:},
  \Macro{MASTER\_<name>\_BACKOFF\_CONSTANT},
  \Macro{MASTER\_<name>\_BACKOFF\_CEILING},

\item Version 1.4.1 of the Generic Connection Broker (GCB) is
  now used for building Condor.  This version of GCB fixes a timing bug
  where a client may incorrectly think a network connection has been established,
  and also guards against an unresponsive client from causing a denial of
  service by the broker.
  For more information about GCB, see section~\ref{sec:GCB} on
  page~\pageref{sec:GCB}. 

% I'm checking this in commented since I'm not sure what disclosure
% policy we want to use. Only CDF (Igor) uses the GLEXEC_STARTER
% functionality, so I think it'd be wise to run it by him before
% documenting this publicly.
%
%\item Fixed a security vulnerability in the \Macro{GLEXEC\_STARTER}
%feature. In previous versions when the \Condor{startd} received the
%user proxy, it placed it in a temporary file that for a short window
%of time could be opened for reading by any user on the system.

\end{itemize}


\noindent New Features:

\begin{itemize}
\item On UNIX, an execute-side Condor installation can run without
root privileges and still execute jobs as different users, properly
clean up when a job exits, and correctly enforce policies specified by
the Condor administrator and resource owners. Privileged functionality
has been separated into a well-defined set of functions provided by a
setuid helper program. This feature currently does not work for the
standard or PVM universes.

%%\item added bogus ImageSize to bogus dedicated scheduler
%%jobAd used only for claiming.  This fixes some problems with
%%startd WANT_SUSPEND going to undefined, but we don't document
%%this bogus ad anywhere, so I'm not going to add it here.

\item Added support for EmailAttributes in the parallel universe.  
Previously, it was only valid in the vanilla and standard universes.

\item Added configuration parameter \Macro{DEDICATED\_SCHEDULER\_USE\_FIFO}
which defaults to true.  When false, the dedicated scheduler will
use a best-fit algorithm to schedule parallel jobs.  This setting is
not recommended, as it can cause starvation.  When true, the dedicated
scheduler will schedule jobs in a first-in, first-out manner.

\item Added \Opt{-dump} to \Condor{config\_val} which will print out
all of the macros defined in any of the configuration files found by
the program.
\Condor{config\_val} \Opt{-dump} \Opt{-v} will augment the output
with exactly what line and in what file each configuration variable
was found.
\Note: The output format of the \Opt{-dump} option will most likely
change in a future revision of Condor.

% Gnats PR 671
\item Node names in \Condor{dagman} DAG files can now be DAG
keywords, except for PARENT and CHILD.

\item Improved the log message when \Attr{OnExitRemove} or
\Attr{OnExitHold} evaluates to UNDEFINED.

% Gnats PR 796
\item Added the \Macro{DAGMAN\_ON\_EXIT\_REMOVE} configuration macro,
which allows customization of the \Attr{OnExitRemove} expression
generated by \Condor{submit\_dag}.

\item When using GCB, Condor can now be told to choose from a list of
brokers. \Macro{NET\_REMAP\_INAGENT} is now a space and comma separated
list of brokers. On start up, the \Condor{master} will query all of the
brokers and pick the least-used one for it and its children to use. If
none of the brokers are operational, then the \Condor{master} will wait
until one is working. This waiting can be disabled by setting 
\Macro{MASTER\_WAITS\_FOR\_GCB\_BROKER} to FALSE in the configuration file.
If the chosen broker fails and recovery is not possible or another broker
is available, the \Condor{master} will restart all of the daemons.

\item When using GCB, communications between parent and child
Condor daemons on the same host no longer use the GCB broker.
This improves scalability and also allows a single host to
continue functioning if the GCB broker is unavailable.

\item The \Condor{schedd} now uses non-blocking methods to send the
``alive'' message to the \Condor{startd} when renewing the job lease.
This prevents the \Condor{schedd} from blocking for 20 seconds while
trying to connect to a machine that has become disconnected from the
network.

\item \Condor{advertise} can read the classad to be advertised from
standard input.

\item Unix Condor daemons now reinitialize their DNS
configuration (e.g. IP addresses of the name servers) on reconfig.

% Gnats PR 777
\item A configuration file for \Condor{dagman} can now be specified
in a DAG file or on the \Condor{submit\_dag} command line.

\item Added \Condor{cod} option \Opt{-lease} for creation of COD claims
with a limited duration lease.  This provides automatic cleanup of COD
claims that are not renewed by the user.  The default lease is infinitely
long, so existing behavior is unchanged unless \Opt{-lease} is explicitly
specified.

\item Added \Condor{cod} command \Opt{delegate\_proxy} which will
delegate an x509 proxy to the requested COD claim.
This is primarily useful for sites wishing to use glexec to spawn the
\Condor{starter} used for COD jobs.
The new command optionally takes an \Opt{-x509proxy} argument to
specify the proxy file.
If this argument is not present, \Condor{cod} will search for the
proxy using the same logic as \Condor{submit} does.

% This is barely a feature, but it's definitely not a bug fix. It's
% more of a change in behavior.
\item \Macro{STARTD\_DEBUG} can now be empty, indicating a default, minimal
log level. It now defaults to empty.
Previously it had to be non-empty and defaulted to include D\_COMMAND.

\item The addition of the \Condor{procd} daemon means that all process
family monitoring and control logic is no longer replicated in each
Condor daemon that needs it. This improves Condor's scalability,
particularly on machines with many processes.

\end{itemize}

\noindent Bugs Fixed:

\begin{itemize}

\item Under various circumstances, condor 6.9.1 daemons would abort
with the message, ``ERROR: Unexpected pending status for fake message
delivery.''  A specific example is when \Attr{OnExitRemove} or
\Attr{OnExitHold} evaluated to UNDEFINED.  This caused the
\Condor{schedd} to abort.

\item In Condor 6.9.1, the \Condor{schedd} would die during startup
when trying to reconnect to running jobs for which the \Condor{schedd}
could not find a startd ClassAd.  This would happen shortly after
logging the following message: ``Could not find machine ClassAds for
one or more jobs.  May be flocking, or machine may be down.
Attempting to reconnect anyway.''

\item Improved Condor's validity checking of configuration values.
For example, in some cases where Condor was expecting an integer but
was given an expression such as 12*60, it would silently interpret
this as 12.  Such cases now result in the condor daemon exiting
after issuing an error message into the log file.

\item When sending a \Code{WM\_CLOSE} message to a process on Windows,
Condor daemons now invoke the helper program \Condor{softkill} to do
so. This prevents the daemon from needing to temporarily switch away
from its dedicated service Window Station and Desktop. It also fixes a
bug where daemons would leak Window Station and Desktop handles. This
was mainly a problem in the \Condor{schedd} when running many scheduler
universe jobs.

\end{itemize}

\noindent Known Bugs:

\begin{itemize}

\item \Condor{glidein} generates a default config file that sets
\Macro{PREEN\_INTERVAL} to an invalid value (0).  To fix this,
remove the setting of \MacroNI{PREEN\_INTERVAL}.

\item There are a couple of known issues with Condor's
\Macro{GLEXEC\_STARTER} feature when used in conjunction with
COD. First, the \Condor{cod} tool invoked with the
\Opt{delegate\_proxy} option will sometimes incorrectly report that the
operation has failed. In addition, the \MacroNI{GLEXEC\_STARTER}
feature will not work properly with COD unless the UID that the each
COD job runs as is different than the UID of the opportunistic job or
any other COD jobs that are running on the execute machine when the
COD claim is activated.

\item The \Macro{EXECUTE\_LOGIN\_IS\_DEDICATED} feature has been found
to be broken on UNIX platforms. Its use will cause the \Condor{procd}
to crash, bringing down the other Condor daemons with it.

\end{itemize}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{\label{sec:New-6-9-1}Version 6.9.1}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\noindent Release Notes:

\begin{itemize}

\item The 6.9.1 release contains all of the bug fixes and enhancements
  from the 6.8.x series up to and including version 6.8.3.

\item Version 1.4.0 of the Generic Connection Broker (GCB) library is
  now used for building Condor, and it is the 1.4.0 versions of the
  \Prog{gcb\_broker} and \Prog{gcb\_relay\_server} programs that are
  included in this release.
  This version of GCB includes enhancements used by Condor
  along with a new GCB-related command-line tool:
  \Prog{gcb\_broker\_query}.
  Condor 6.9.1 will not work properly with older versions of the
  \Prog{gcb\_broker} or \Prog{gcb\_relay\_server}.
  For more information about GCB, see section~\ref{sec:GCB} on
  page~\pageref{sec:GCB}. 

\end{itemize}

\noindent New Features:

\begin{itemize}

\item Improved the performance of the ClassAd matching algorithm,
which speeds up the \Condor{schedd} and other daemons.

\item Improved the scalability of the algorithm used by 
the \Condor{schedd} daemon to find runnable jobs.
This makes a noticeable difference in \Condor{schedd} daemon performance,
when there are on the order of thousands of jobs in the queue.

\item the \Dflag{COMMAND} debugging level has been enhanced to
log many more messages. 

\item Updated the version of DRMAA, which contains several great
improvements regarding scalability and race conditions.

% Gnats PR 774
\item Added the \Macro{DAGMAN\_SUBMIT\_DEPTH\_FIRST} configuration macro,
which causes \Condor{dagman} to submit ready nodes in more-or-less depth-first
order, if set to \Expr{True}.  The default behavior is to submit
the ready nodes in breadth-first order.

\item Added configuration parameter \Macro{USE\_PROCESS\_GROUPS}.
If it is set to \Expr{False},
then Condor daemons on Unix machines will not create new 
sessions or process groups. This is intended for use with Glidein, as
we have had reports that some batch systems cannot properly track jobs that
create new process groups. The default value is \Expr{True}.

\item The default value for the submit file command
\SubmitCmd{copy\_to\_spool} has been changed to \Expr{False}, because copying
the executable to the spool directory for each job (or job cluster) is almost
never desired.  Previously, the default was \Expr{True} in all
cases, except for grid universe jobs and remote submissions.

\item More types of file transfer errors now result in the job going
on hold, with a specific error message about what went wrong.  The new
cases involve failures to write output files to disk on the submit
side (for example, when the disk is full).
As always, the specific error number is
recorded in \Attr{HoldReasonSubCode}, so you can enforce an automated
error handling policy using \SubmitCmd{periodic\_release} or
\SubmitCmd{periodic\_remove}.

\item Added the \Macro{<SUBSYS>\_DAEMON\_AD\_FILE}
configuration variable, which is similar to the 
\Macro{<SUBSYS>\_ADDRESS\_FILE}.
This new variable will be used in future versions of Condor, but is
not necessary for 6.9.1.


\end{itemize}

\noindent Bugs Fixed:

\begin{itemize}

\item Fixed a bug in the \Condor{master} so that it will now send obituary
e-mails when it kills child processes that it considers hung.

\item \Condor{configure} used to always make a personal Condor with
\Opt{--install} even when \Opt{--type} called for only execute or
submit types.  Now, \Condor{configure} honors the \Opt{--type}
argument, even when using \Opt{--install}.
If \Opt{--type} is not specified, the default is to still install a
full personal Condor with the following daemons: 
\Condor{master}, \Condor{collector},
\Condor{negotiator}, \Condor{schedd}, \Condor{startd}. 

\item While removing, putting on hold, or vacating a large number of
jobs, it was possible for the \Condor{schedd} and the \Condor{shadow} to
temporarily deadlock with each other.  This has been fixed under Unix,
but not yet under Windows.

\item Communication from a \Condor{schedd} to a \Condor{startd}
now occurs in a nonblocking manner.
This fixes the problem of the \Condor{schedd} blocking 
when the claimed machine running the \Condor{startd}
cannot be reached, for example because the machine is turned off.

\end{itemize}

\noindent Known Bugs:

\begin{itemize}

\item Under various circumstances, condor 6.9.1 daemons abort
with the message, ``ERROR: Unexpected pending status for fake message
delivery.''  A specific example is when \Attr{OnExitRemove} or
\Attr{OnExitHold} evaluated to UNDEFINED, which causes the
\Condor{schedd} to abort.

\item In Condor 6.9.1, the \Condor{schedd} will die during startup
when trying to reconnect to running jobs for which the \Condor{schedd}
can not find a startd ClassAd.  This happens shortly after
logging the following message: ``Could not find machine ClassAds for
one or more jobs.  May be flocking, or machine may be down.
Attempting to reconnect anyway.''

\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{\label{sec:New-6-9-0}Version 6.9.0}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\noindent Release Notes:

\begin{itemize}

\item The 6.9.0 release contains all of the bug fixes and enhancements
  from the 6.8.x series up to and including version 6.8.2.

% and a few \condor{gridmanager} bug fixes from 6.8.3.  *sigh* we need
% a real solution to this problem (like pointing to issue node ids) ;)

\end{itemize}


\noindent New Features:

\begin{itemize}


\item Preliminary support for using \Prog{glexec} on execute machines
has been added.  This feature causes the \Condor{startd} to spawn the
\Condor{starter} as the user that \Prog{glexec} determines based on
the user's GSI credential.

\item A ``per-job history files'' feature has been added to the
\Condor{schedd}. When enabled, this will cause the \Condor{schedd} to
write out a copy of each job's ClassAd when it leaves the job
queue. The directory to place these files in is determined by the
parameter \Macro{PER\_JOB\_HISTORY\_DIR}. It is the responsibility of
whatever external entity (for example, an accounting or monitoring system) is
using these files to remove them as it completes its processing.

\item \Condor{chirp} command now supports writing messages to the user log.

\item \Condor{chirp} getattr and putattr now send all classad getattr
and putattr commands to the proc 0 classad, which allows multiple proc
parallel jobs to use proc 0 as a scratch pad.

\item Parallel jobs now support an \Attr{AllRemoteHosts} attribute,
which lists all the hosts across all procs in a cluster.

\item The \Macro{DAGMAN\_ABORT\_DUPLICATES} configuration macro (which causes
\Condor{dagman} to abort itself if it detects another \Condor{dagman}
running on the same DAG) now defaults to \Expr{True} instead of
\Expr{False}.

\end{itemize}

\noindent Bugs Fixed:

\begin{itemize}

\item None.

\end{itemize}

\noindent Known Bugs:

\begin{itemize}

\item None.

\end{itemize}

