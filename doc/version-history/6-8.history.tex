%%%      PLEASE RUN A SPELL CHECKER BEFORE COMMITTING YOUR CHANGES!
%%%      PLEASE RUN A SPELL CHECKER BEFORE COMMITTING YOUR CHANGES!
%%%      PLEASE RUN A SPELL CHECKER BEFORE COMMITTING YOUR CHANGES!
%%%      PLEASE RUN A SPELL CHECKER BEFORE COMMITTING YOUR CHANGES!
%%%      PLEASE RUN A SPELL CHECKER BEFORE COMMITTING YOUR CHANGES!

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{\label{sec:History-6-8}Stable Release Series 6.8}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

This is a stable release series of Condor.
It is based on the 6.7 development series.
All new features added or bugs fixed in the 6.7 series are available
in the 6.8 series.
As usual, only bug fixes (and potentially, ports to new platforms)
will be provided in future 6.8.x releases.
New features will be added in the forthcoming 6.9.x development series.

%%%%%%
% we need a summary of major new features since 6.6.x here.  trying to
% sort through the 21 different 6.7.x releases and all the new
% features is a huge amount of noise.  people just want to see a
% summary of the major new functionality.
% \Todo
%%%%%%

The 6.8.x series supports a different set of platforms than 6.6.x.
Please see the updated table of available platforms in
section~\ref{sec:Availability} on page~\pageref{sec:Availability}.

The details of each version are described below.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{\label{sec:New-6-8-8}Version 6.8.8}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\noindent Release Notes:

\begin{itemize}

\item This release fixes a security vulnerability that affects
those who rely upon Condor's network message integrity checking
(where the configuration is set to
\verb@SEC_DEFAULT_INTEGRITY = REQUIRED@).  Not all of
Condor's network communications are vulnerable to the integrity
checking bug, so based on the scope of the affected parts, we consider
the level of threat to be modest.  A denial of service attack could be
launched against Condor by an attacker who tampers with Condor's
network communications.  All previous releases of Condor are affected
by this bug.  For users of the 6.9 development series, a
fix for this problem will be released as part of the new 7.0.0 stable
series release, which is planned to happen near the end of 2007.

\end{itemize}


\noindent New Features:

\begin{itemize}

\item None.

\end{itemize}

\noindent Bugs Fixed:

\begin{itemize}

\item Fixed a named pipe collision on Windows: streaming error and 
output would not work on more than one slot
(Condor version 6.8.8 terminology: Condor vm) at a time.

\item Fixed a bug in Condor's network message integrity checking.

\item Fixed a forward-compatibility problem when a 6.8 \Condor{startd}
runs jobs for a 6.9 or later \Condor{schedd} and the communication
between them is configured to use integrity checking or encryption.
The problem caused the \Condor{startd} to crash.

\item Fixed a problem that sometimes caused corruption of ClassAd data
that is forwarded from one \Condor{collector} daemon to another via
\MacroNI{CONDOR\_VIEW\_HOST}.

\end{itemize}

\noindent Known Bugs:

\begin{itemize}

\item None.

\end{itemize}

\noindent Additions and Changes to the Manual:

\begin{itemize}

\item None.

\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{\label{sec:New-6-8-7}Version 6.8.7}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\noindent Release Notes:

\begin{itemize}

\item None.

\end{itemize}


\noindent New Features:

\begin{itemize}

\item None.

\end{itemize}

\noindent Bugs Fixed:

\begin{itemize}

\item On Windows, fixed a problem that could cause spurious failures with Condor-C
or with streaming a job's standard output or error.

\item A claim in the state Claimed/Idle could not be preempted until
it transitioned into Busy or went away of its own accord.  This bug
was introduced in 6.7.1.

\item The user-based authorization parameters in the configuration file
(for example, \MacroNI{ALLOW\_READ}) now properly recognize values where the
user name contains a wild card
(for example, \MacroNI{*@cs.wisc.edu/bird.cs.wisc.edu}).

\item A rare threading problem in the Windows version of Condor has
been fixed.  The problem could cause memory corruption in the
\Condor{starter} while receiving input files and in the
\Condor{schedd} while transferring input/output files for a remotely
submitted job or a spooled job.

% PR 908
\item Increased the verbosity of some error messages (related to
reading log files) in \Condor{dagman}.

% PR 906
\item Fixed a bug in \Condor{dagman} that would cause it to hang if it
was unable to successfully spawn a PRE or POST script.  This case is now
dealt with as a PRE or POST script failure.

\end{itemize}

\noindent Known Bugs:

\begin{itemize}

\item None.

\end{itemize}

\noindent Additions and Changes to the Manual:

\begin{itemize}

\item None.

\end{itemize}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{\label{sec:New-6-8-6}Version 6.8.6}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\noindent Release Notes:

\begin{itemize}

\item Condor is now officially supported on Microsoft Vista.

\item Condor is now officially supported on MacOS running natively on Intel CPUs.  (and Condor binaries for Intel MacOS are now available for download).

\item Condor now uses Globus 4.0.5 for GSI, pre-WS GRAM, and GridFTP support.

\end{itemize}


\noindent New Features:

\begin{itemize}

\item On all Unix ports of Condor except MacOSX, AIX, and Tru64, separate
debug symbol files are now supported. This allows meaningful debugging of
core files in addition to attaching to stripped executables during runtime.

\item \Condor{dagman} now prints reports of pending nodes to the
\File{dagman.out}, if it has been waiting more than
\MacroNI{DAGMAN\_PENDING\_REPORT\_INTERVAL} seconds without seeing
any node job events.  This is to help diagnose the problem if
\Condor{dagman} gets "stuck".

% This is a back-port from 6.9
\item Optimized the submission of grid-type gt4 grid universe jobs to the
remote resource. Submission now takes one operation instead of three.

\item The \Condor{shadow} will obtain a session key to the \Condor{schedd}
at the start of the job instead of potentially waiting until the job
completes.  This reduces the chances of re-running already completed jobs
in the event of authentication failures (for instance, if a Kerberos KDC is
down or overloaded).

\end{itemize}

\noindent Bugs Fixed:

\begin{itemize}

\item On MacOS, Condor is more robust about how it monitors characteristics (such as image size) of a running job.  Fixed several issues that would cause the \Condor{startd} to exit on MacOS 10.4 running on Intel processors.

\item Fixed bug in the local universe where the local universe 
execute directory was not removed when the job could not start.  The most
common case was an incorrectly named executable file.

\item 
Fixed a bug that prevented dollar dollar expansions with a default 
argument that contained forward slashes from expanding properly.
An example that now works correctly, but exhibited the incorrect
behavior:
\begin{verbatim}
$$(SomeVariable:/path/to/file)
\end{verbatim}

\item The Windows installer now works on MS Vista.  Also, it does not 
pop up any command windows.

\item The \Condor{ckpt\_server} was fixed to honor \MacroNI{HIGHPORT}
and \MacroNI{LOWPORT}. While the well-known ports for the checkpoint
data server have not changed, the helper processes that perform the store
and restore (which communicate directly with the standard universe job)
now bind to ports within specified ranges. Note that this will limit
the number of simultaneous store/restore requests to the number of
available ports.

% Gnats PR 846/condor-admin 15417
\item Fixed a bug in \Condor{dagman} that caused recovery/bootstrap
mode to be very slow on large DAGs (i.e., ones with hundreds of thousands
of nodes).

% Gnats PR 854/condor-support 2012
\item Fixed a bug that caused \Condor{dagman} to incorrectly deal
with VARS lines specifying more than one macro name (this bug was
introduced in version 6.8.5).

\item Fixed a bug in the configuration macro \MacroNI{RANDOM\_INTEGER}
when used as part of a larger expression.  The entire configuration
value containing the reference to \MacroNI{RANDOM\_INTEGER} was being
replaced by the chosen random integer, rather than just having
\MacroNI{RANDOM\_INTEGER}() itself be replaced.

\item Fixed a bug in the GSI configuration parameters. 
If \Attr{GSI\_DAEMON\_DIRECTORY} was set and \Attr{GRIDMAP} was not set, 
then Condor would look in the wrong location for the GSI private key and 
mapfile.

\item \Condor{q} would produce garbage output in its error message when
failing to contact the collector specified via \Opt{-pool}.

\item In Unix only, 
fixed a file descriptor leak that could cause the \Condor{schedd}
daemon to crash.

\item File transfer failures for spooled jobs no longer result in
\Condor{schedd} child processes hanging around for 8 hours before finally
exiting.  Too many such processes occasionally resulted in memory exhaustion.

% Gnats PR 868/condor-admin 15848
\item Fixed a bug in \Condor{dagman}: \Attr{DIR} and \Attr{ABORT-DAG-ON}
specifications were not propagated to rescue DAGs.

% condor-admin #15710
\item Added a workaround for a bug in the Globus GRAM JobManager
(\URL{http://bugzilla.mcs.anl.gov/globus/show\_bug.cgi?id=5467})
that can cause very short jobs' standard output and error to be lost.

\item Disable GSI authorization callouts for the GridFTP server that Condor
starts to perform file transfers for grid-type gt4 grid universe jobs.

\end{itemize}

\noindent Known Bugs:

\begin{itemize}

\item Grid universe type GT4 (web services GRAM) does not work properly on Itanium-based machines, because it requires Java 1.5, which is not available on the Itanium (ia\_64).

\end{itemize}

\noindent Additions and Changes to the Manual:

\begin{itemize}

\item Several updates to the DAGMan documentation (section~\ref{sec:DAGMan}).

% PR 893
\item Improved the group quota documentation.

\end{itemize}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{\label{sec:New-6-8-5}Version 6.8.5}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\noindent Release Notes:

\begin{itemize}

\item This release is not fully compatible with the 6.6 series (or
anything earlier than that).  Specifically, a 6.6 schedd will be rejected when
it tries to contact a 6.8.5 startd to make use of a claim.

\item The Globus libraries used by Condor now include the following advisory
packages:
  \begin{itemize}
  \item globus\_gss\_assist-3.23
  \item globus\_xio-0.35
  \item globus\_gram\_protocol-6.5
  \item globus\_gass\_transfer-2.12
  \end{itemize}
See \URL{http://www.globus.org/toolkit/advisories.html} for details on the
bugs fixed by these updated packages.
The patch given in Globus Bugzilla 5091
(\URL{http://bugzilla.mcs.anl.gov/globus/show\_bug.cgi?id=5091}) is also
included.

\end{itemize}


\noindent New Features:

\begin{itemize}

\item A clipped port to x86 Debian 4.0 has been added.

\item The functionality embodied in \Condor{q} \Opt{-better-analyze} is now
available for X86\_64 native ports of Condor.

\item We now supply distinct, native ports for Mac OS X 10.3 and 10.4.

\item There is a new configuration macro
\MacroNI{COLLECTOR\_REQUIREMENTS} that may be used to filter out
unwanted ClassAd updates.  For more information, see
section~\ref{param:CollectorRequirements}.

\item Added a \Opt{-f} option to \Condor{store\_cred}, which generates
a pool password file that can be used for the PASSWORD authentication
method on Unix Condor installations.

\end{itemize}

\noindent Bugs Fixed:

\begin{itemize}

\item The config file entry \Macro{HOSTALLOW\_DAEMON} is now looked at in
addition to \Macro{ALLOW\_DAEMON}.

\item Fixed a bug where under certain conditions Condor's file logging codes
would perform a segmentation fault.

\item Removed periodic re-indexing of the quill history\_vertical table.
This should not be needed with the current schema, and it should speed
up database re-indexing operations.

\item Fixed a bug that would cause the dedicated scheduler to
crash, if the \Condor{schedd} was suspended or blocked
for more than approximately 10 minutes.
The most likely cause of a suspension
is a \Condor{schedd} executable
mounted from a remote NFS file system.

\item Fixed a bug where if \Opt{-lc} was specified multiple times for
the compiler when using \Condor{compile} (some tools like \Prog{pgf90}
do this), \Condor{compile} would fail to link the application and emit
a multiply defined symbol error for many symbols.

\item Fixed a bug where Condor erroneously indicates that a scheduler
universe's job executable is missing or not executable.
This occurred if the scheduler
universe job had been submitted with
\SubmitCmd{CopyToSpool = false} in the submit
description file, and the user had a umask which prevented the user
named \Login{condor} from following the search path to the
user-owned executable.

\item Fixed a bug that could cause the \Condor{schedd} to crash if it
received too many matches in one negotiation cycle (more than 1000 on a
Linux platform).

\item Fixed a bug in which \Condor{history} did not honor the \Opt{-format} flag
properly when Quill is in use.

\item Fixed a bug in which a java property that includes
surrounding double quote marks
caused the detection of a java virtual machine to go awry. 
The fix, which may change in the future, changes any extra double quotes
within a property value to single quotes.

\item Fixed a bug in which the \Condor{quill} daemon 
crashed occasionally when the Postgres database
server was unavailable.

\item The Solaris 9 Condor package can be used under Solaris 10 again.
Changes in 6.7.20 broke this compatibility.

% PR 806
\item \Condor{dagman} now does a better job, especially in recovery mode,
of detecting potentially incorrect submit events.
Those have Condor IDs not matching what is expected.

% PR 814
\item \Condor{dagman} now truncates existing node job user log files
to zero length, rather than deleting the log files.  This prevents breaking the
link if a user log file is set up as a link.

\item When starting a GridFTP server to handle file transfers for gt4
grid jobs, the \Condor{gridmanager} now properly sets the
GLOBUS\_TCP\_PORT\_RANGE and GLOBUS\_TCP\_SOURCE\_RANGE environment
variables if appropriate.

\item Fixed a bug that could cause a security session to get deleted
by the server (for example, the \Condor{schedd}) before the client
(for example, the \Condor{shadow}) was done using it.
This bug can be observed as
communication failure the next time the client tried to connect to
the server.  In some cases, this caused jobs to be re-queued to be run
again, because the final update of the job queue failed.

\item If a grid job becomes held while it's still submitted to the remote
resource and is then removed, the \Condor{gridmanager} will now attempt
to remove the job from the remote resource before letting it leave the
local job queue.

\item Fixed a bug in the \Condor{c-gahp} that caused it to not use the 
user's credential for authentication with the remote schedd on some 
connections.

\item The \Condor{c-gahp} now properly lists all of the commands it
supports in response to the COMMANDS command.

\item Fix a bug in how the \Condor{c-gahp} updates configuration parameter
\Macro{GSI\_DAEMON\_NAME} to include the job's credential if it has one.

% Gnats PR 815
\item Removed the 5096-character restriction on the length of DAG
macro values (and names) in \Condor{dagman}.

\item Condor-G will now notice when jobs are missing from the status
reports sent by the Grid Monitor.
Jobs can disappear for short periods of time under normal circumstances,
but a prolonged absence is often a sign of problems on the remote machine.
The amount of time that a job can go missing from the Grid Monitor
status reports before the \Condor{gridmanager} reacts can be set by the
new configuration parameter \Macro{GRID\_MONITOR\_NO\_STATUS\_TIMEOUT}.
The default is 15 minutes.

\item \Condor{q} -analyze will now print a warning if a job being analyzed
is already completed or if a grid universe job being analyzed has already
been matched.

\item In \Condor{shadow}, when forwarding an updated X509 proxy to an
executing job, the logic for whether to delegate or copy the proxy 
(determined by configuration parameter
\Macro{DELEGATE\_JOB\_GSI\_CREDENTIALS}) was reversed.
The authentication logic for this operation was also incorrect, causing the
operation to fail in many instances.

\item Made a small improvement to the reliability of Condor's process
ancestry tracking under Linux.  However, jobs that create children
with more than 4096 bytes of environment are still problematic, due to
a Linux kernel limitation that prevents reading more than 4k from
/proc/<pid>/environ.  The only truly reliable way to ensure that
Condor is aware of all processes spawned by a Unix job is to use
\MacroNI{VMx\_USER}.

\item \Condor{glidein} option \Opt{-run\_here} no longer fails when the
current working directory is not in PATH.

\item \Condor{glidein} option \Opt{-runtime} would cause runtime errors
at startup under some batch systems.  The problematic parentheses characters
are no longer generated as part of the environment value that is set by
this option.

\item On rare occasions, the \Condor{startd} will compute a negative MIPS
rating when performing benchmarks on the machine. This caused the
\Attr{Mips} attribute to disappear from the machine ad. Now, the
\Condor{startd} ignores these bogus results. The cause of the negative MIPS
ratings is still unknown.

% PR 826
\item Fixed a bug that caused \Condor{dagman} to hang if it processed,
in recovery mode, a node for which all submit attempts failed and a
POST script was run.

\item Fixed a bug that would cause the \Condor{negotiator}'s memory
usage to grow over time when job or machine ClassAds made use of
ClassAd functions that do regular expression matching operations.

\item Fixed a bug that was preventing Condor daemons from caching DNS
information for hosts authenticated via HOSTALLOW settings (i.e. no
strong authentication).  The collector, in particular, should spend
much less time on IP to host name lookups.

\item When a job has an X509 proxy file (as indicated by the
\Attr{X509UserProxy} attribute in the job ad), the \Condor{starter}
now always sets \Attr{X509\_USER\_PROXY} in the job's environment
to point to a copy of that proxy file.

\item Fixed several bugs that could cause the \Condor{c-gahp} to time out
when talking to the \Condor{schedd} and falsely report that commands
completed successfully. A common result is grid type condor grid universe
jobs being placed on hold because the \Condor{gridmanager} mistakenly
thinks they disappeared from the remote \Condor{schedd}'s queue.

% PR 771
\item Fixed a bug in Stork which was causing it to write the output and
error log files as the wrong user, and read the input file as the wrong
user.

% PR 773
\item Fixed a bug in Stork which was causing it to kill hung jobs
as the wrong user.

\item Fixed some possible static buffer overflows related to the
transferring of a job's data files.

\item Jobs with standard output and error going to the same file should
not lose data in the common case.

\item Heavily loaded condor daemons (e.g. \Condor{schedd}) had a
problem when they got behind processing the exit status of child
process (e.g. \Condor{shadow}).  The problem was that the daemon would
continue to expect status updates from its child, even after the child
had exited, and when the daemon decided that the lack of status
updates meant that the child was hung, the daemon would try to kill
any process that happened to have the same pid as the child which had
already exited.  In the case of the schedd, this would also result in
the job run attempt being marked as a failure and the job would remain
in the queue to run again.  Condor no longer activates the ``hung child''
procedure for jobs which have exited but which have not yet had their
exit status processed internally by the daemon.

\item For grid-type condor jobs, made the \Condor{gridmanager} more
tolerant of unexpected responses from the remote \condor{schedd}.

\item On HPUX and AIX, fixed a bug that could cause Condor's process
family tracking logic to lose track of processes.

\item Fixed a memory error that would cause \Condor{q} to sometimes
crash when using Quill.

\item Fixed a problem where the Windows \Condor{credd} would be
inaccessible to other Condor components if \Macro{CREDD\_HOST} were
set to a DNS alias and not the canonical DNS name.

\item Fixed a bug in the \Condor{shadow} on Windows where it would
fail to correctly perform the PASSWORD authentication method.

\item The Windows \Condor{credd} now uses the configuration parameter
\Attr{CREDD\_HOST}, if defined, to set its name when advertising itself
to the \Condor{collector}. Thus, if \Attr{CREDD\_HOST} is set to something
other than then \Condor{credd}'s host name, clients can still locate the
daemon.

\item Fixed a bug in the \Condor{c-gahp} that could cause it to not
perform hold, release, or remove commands on jobs in the remote
\Condor{schedd}.

\item Fixed the default value of configuration parameter
\Attr{STARTD\_AD\_REEVAL\_EXPR}.

\end{itemize}

\noindent Known Bugs:

\begin{itemize}

% Gnats PR 954/condor-support 2012.
\item \Condor{dagman} incorrectly parses DAG file VARS lines specifying
more than one macroname/value pair.  You can work around this problem
by specifying each macroname/value pair on a separate line.  (This bug
was introduced in version 6.8.5.)

\end{itemize}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{\label{sec:New-6-8-4}Version 6.8.4}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\noindent Release Notes:

\begin{itemize}

\item None.

\end{itemize}


\noindent New Features:

\begin{itemize}

\item Added new tool \Condor{dump\_history} which will
enable schema migration to future Quill schema versions.

\item Quill can now automatically rebuild the indexes on the
\Prog{PostgreSQL} database tables.  Some sites reported that even
with auto vacuuming turned on, the indexes on the tables were 
growing without bounds.  Rebuilding the indexes fixes that problem.
Rebuilding is disabled by setting the parameter 
\Macro{QUILL\_SHOULD\_REINDEX}
to \Expr{False}.  Re-indexing happens immediately after the history file
is purged of old data. So, if Quill is configured to never delete
history data, the tables are never re-indexed.  Also, \Condor{quill}
was changed so that the history deletion also happens at start time.
This ensures that old history rows are deleted if Quill crashes
before the scheduled deletion time.

\item Added more information to StarterLog for an error message
involved in file transfers: 
\begin{verbatim}
Download acknowledgment missing attribute: Result.
\end{verbatim}
The extra information is a full dump of the
ClassAd that was received, in order to help determine why the expected
attribute was not found.

\item Added output to the \File{dagman.out} file documenting when
\Condor{dagman} shortcuts node retries because of \Condor{submit}
failures or a helper command failure.

\end{itemize}

\noindent Bugs Fixed:

\begin{itemize}

\item Fixed a bug in \Condor{q} that only happened when running 
with a Quill database and using the long (-l) option.  The bug was 
introduced in 6.8.3.  The bug truncated the output of \Condor{q}, and
only displayed some of the job attributes.

\item Fixed a bug in \Condor{submit} that caused standard universe jobs
to be unable to open their standard output or standard error, if
\SubmitCmd{should\_transfer\_files} is \SubmitCmd{YES} or 
\SubmitCmd{IF\_NEEDED} in the submit description file.

\item Fixed a bug in \Condor{glidein} that could cause it to request the
queue unknown when submitting its setup job to GRAM, leading to
failures.

\item The \Attr{OnExitRemove} expression generated for DAGMan by
\Condor{submit\_dag} evaluated to UNDEFINED for some values of
\Attr{ExitCode}, causing \Condor{dagman} to go on hold.

\item Fixed a bug in which garbage values (random bits from memory)
were sometimes
written to the pool history file in the field representing the
backfill state.

% Gnats PR 798
\item \Condor{submit\_dag} now generates a submit file
(\File{.condor.sub}) for \Condor{dagman} that sends \File{stdout} and
\File{stderr} to separate files.  This has always been recommended,
and recent versions of Condor cause \File{stdout} and \File{stderr} to
overwrite each other if they are directed to the same file.

\item Fixed several bugs for grid type \SubmitCmd{nordugrid} jobs.
The \Condor{gridmanager} would create an invalid RSL for these jobs
and save their output to the wrong location in some cases.

\item \Condor{glidein} now properly escapes glidein tarball URLs that
contain characters that have special meaning to GRAM RSL. It also turns
on TCP updates to the \Condor{collector},
if they are enabled on the submit machine.

\item When using the submit file option \SubmitCmd{getenv=true},
environment
variables containing a newline in their value are no longer inserted
into the job's environment.  The \Condor{schedd} daemon
does not allow newlines
within ClassAd values, so the attempt to insert such values resulted
in failure of job submission and caused the \Condor{schedd} daemon
to abort.

% Gnats PR 799
\item Fixed a bug that caused \Condor{dagman} to hang if a node
with a POST script and retries initially runs but fails, and then
has all \Condor{submit} attempts fail on the retry.

\item Fixed a problem in the Windows installer where the
\Macro{DAEMON\_LIST} parameter would be incorrectly set if the ``Join
an existing Condor pool'' option was selected or the ``Submit jobs to
Condor pool'' option was unchecked.  In the first case, a
\Condor{collector} and \Condor{negotiator} would incorrectly be run on
the machine. In the second case, a \Condor{schedd} would incorrectly
be run. The problem exists in all previous 6.8 and 6.9 series
releases.

\item Fixed a bug in the handling of local universe jobs
for a very busy \Condor{schedd} daemon.
When a local universe job completed, the \Condor{starter} might not
be able to connect to the \Condor{schedd} daemon to update final information
about the job, such as the exit status.
Under this circumstance,
the \Condor{starter} would hang indefinitely.
The bug is fixed by having the \Condor{starter} attempt
to retry a few times (with a delay in between each attempt) before
exiting with a fatal error.
The fatal error causes the job to restart.

\end{itemize}

\noindent Known Bugs:

\begin{itemize}

% Gnats PR 813
\item Setting \MacroNI{DAGMAN\_DELETE\_OLD\_LOGS} to false can cause
\Condor{dagman} to have problems (including hanging), especially
when running a rescue DAG.  If you want to keep your old user log
files, the best thing to do is to rename them before each
\Condor{dagman} run.  If you do run with
\MacroNI{DAGMAN\_DELETE\_OLD\_LOGS} set to false, check your
\File{dagman.out} file for error messages about submit event
Condor IDs not matching the expected value.  If you get such an
error, you will probably have to \Condor{rm} the \Condor{dagman}
job, remove or rename the old user log file(s) and run the rescue DAG.
(Note: this bug also applies to earlier versions of \Condor{dagman}.)

\end{itemize}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{\label{sec:New-6-8-3}Version 6.8.3}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\noindent Release Notes:

\begin{itemize}

\item In this release,
the command \Condor{q} \Arg{-long} does not work when querying
the Quill database.
Instead, use the command
\Condor{q} \Arg{-direct quilld} \Arg{-long},
or use a previous version of \Condor{q}.

\item Performed a security audit of all places where Condor opens files,
to make certain files are opened with a reasonable permission mode
and with the
O\_EXCL flag whenever possible.

\end{itemize}


\noindent New Features:

\begin{itemize}

\item Added the \Macro{JOB\_INHERITS\_STARTER\_ENVIRONMENT}configuration
macro.  When set
to \Expr{True}, jobs inherit all environment variables from
the \Condor{starter}.  This is useful for glidein jobs that need to access
environment variables from the batch system running the glidein daemons.
The default for this configuration macro is \Expr{False}, so existing behavior
is unchanged.  This feature does not apply to standard and pvm universe
jobs.

\item Changed the default UDP receive buffer for the
\Condor{collector} from 1M to 10M.  This value can be configured with
the (existing) \MacroNI{COLLECTOR\_SOCKET\_BUFSIZE} macro.

\Note For some Linux distributions, it may be necessary to configure
a larger value than the default; this parameter is
/proc/sys/net/core/rmem\_max .  You can see the values that the
\Condor{collector} actually used by enabling D\_FULLDEBUG for the
\Condor{collector} and looking at the log line that looks like this:

Reset OS socket buffer size to 2048k (UDP), 255k (TCP).

\item Added a new configuration macro to control the size of the
TCP send buffers for the \Condor{collector}.  This macro used to
be the same as \MacroNI{COLLECTOR\_SOCKET\_BUFSIZE}.  The new macro is
\Macro{COLLECTOR\_TCP\_SOCKET\_BUFSIZE}, and it defaults to 128K.

\item Added a clipped port for SuSE Linux Enterprise Server 9 running on the 
PowerPC architecture.  Note the known bug below.

\item The \Condor{schedd} now maintains a birth date for the job queue. 
Nothing in Condor currently uses this feature, but future versions of \Condor{quill} may require it. 

\item There is a new configuration file macro
\MacroNI{RANDOM\_INTEGER}(min,max[,step]).  It produces a
pseudo-random integer within the range \verb@min@ and \verb@max@,
inclusive at configuration time.

\end{itemize}

\noindent Bugs Fixed:

\begin{itemize}

\item Fixed a deadlock situation between the \Condor{schedd} and
the \Condor{startd} that can
significantly impact the \Condor{schedd}'s performance.  The likelihood of the
deadlock increased based upon the number of VMs advertised by the
\Condor{startd}.

\item Fixed a bug reading the user job log on Windows that caused
occasional DAGMan confusion.
Thanks to Fairview Software, Inc. for
both finding the bug and writing a patch.

\item Fixed a denial of service problem: Condor daemons no longer freeze
for 20 seconds when a client connects to them and then sends no data.
This behavior is common with port scanners.

\item Fixed a race condition with \Condor{quill} caused by
\Prog{PostgreSQL}'s default transaction isolation level being ``read
committed''. 
This bug would cause truncated \Condor{q} reads when using Quill.

\item Fixed a bug where the \Condor{ckpt\_server} would segfault when
turned off with \Condor{off} \Opt{-fast}.

\item Fixed a bug in the \Condor{startd} where it could die with
  SIGABRT when a \Condor{starter} exited under certain rare
  circumstances.
  The bug seems to have been most likely to appear on x86\_64 Linux
  machines, but could potentially affect all platforms.

\item Fixed a problem with \Condor{history} when running with Quill enabled,
which caused it to allocate an unbounded amount of memory.

\item Fixed a problem with \Condor{q} when running with Quill, which caused
it to silently truncate the printing of the job queue.

\item Fixed a bug in the \Condor{gridmanager} that caused the following
configuration files parameters to be ignored for grid types condor and
nordugrid jobs: \MacroNI{GRIDMANAGER\_RESOURCE\_PROBE\_INTERVAL},
\MacroNI{GRIDMANAGER\_MAX\_PENDING\_SUBMITS\_PER\_RESOURCE}, and
\MacroNI{GRIDMANAGER\_MAX\_SUBMITTED\_JOBS\_PER\_RESOURCE}.

\item Fixed a bug in \Condor{run} that caused it to abort on non-fatal
warnings from \Condor{submit} and print incorrect error messages.

\item Fixed a bug in the \Condor{gridmanager} dealing with grid type gt4
grid universe jobs. If the job's standard output or error was not specified
in the job ClassAd, the \Condor{gridmanager} would create an improper GRAM
RSL string, causing the job to fail.

\item Fixed a bug in the \Condor{gridmanager} that could cause it to
delegate the wrong credential when refreshing the credentials for a
grid type gt4 grid universe job.

\item The \Condor{gridmanager} could get into a state where it would no
longer start up Globus jobmanagers for grid type gt2 grid universe jobs,
if previous requests failed due to connection errors. This bug has been
fixed.

\item The \Condor{c-gahp} now properly exits when the pipe to its parent
goes away. Before, it would fill its log with large amounts of useless
messages, before exiting several minutes later.

\item Fixed a bug where a problem opening standard input, output, or error,
the standard universe might generate an incorrect warning in the 
\Condor{shadow}'s log.

\item The \Condor{gridmanager} now recovers properly when a proxy refresh
fails for a gt2 grid universe job in the stage-out state. Before, the job
would become held with a hold reason of ``Globus error 3: an I/O operation
failed''.

\item A number of fixes to minor typos and incorrect formatting in
Condor's log files.

\item When \MacroNI{REQUEST\_CLAIM\_TIMEOUT} was reached and the
\Condor{schedd}
failed to contact the \Condor{startd} to release the claim, the 
\Condor{schedd} would
periodically try releasing the claim indefinitely, possibly resulting in
a lengthy communication delay each time.

\item Under Windows, Condor daemons such as the \Condor{schedd} were sometimes
limiting their use of pending connect operations more than they should
have.  This would result in the message, ``file descriptor safety level
exceeded''.

\item \Condor{fetchlog} no longer allows or documents the -dagman option.
The option's appearance was an error.  The option never worked.

\item The \Condor{schedd} ensures that the initial job queue log file
contains a sequence number for use by Quill.  This fixes a case in
which no sequence number was inserted, because the initial rotation of
this (empty) file failed.  Quill also now reports exactly what the
problem is if it reads a job queue log in this state, rather than
simply crashing.  This problem has so far only been observed under
Windows.

\item Fixed a problem on Windows where, when submitting a job with a
sandbox (for example, using the \Opt{-s} or \Opt{-r} option to
\Condor{submit}), an erroneous file permissions check in the
\Condor{schedd} would result in a failed submission.

\item The \Condor{startd} would crash shortly after start up if the
\MacroNI{RANK} expression contained any use of the unary minus
operator.  This patch should also fix any other cases where Condor
daemons crashed due to the use of the unary minus operator in ClassAd
expressions.

\item Stork now writes a terminated event to the user log when it removes
a transfer job from its queue because of failures to invoke a transfer
module. Without this event, DAGMan would not notice that these jobs had
left the queue.

\item Fixed a problem where the \Condor{schedd} on Windows would
incorrectly reject a job if the client provided an \Attr{Owner}
attribute that was correct but differed in case from the authenticated
name. This bug was thought to have been fixed in Condor 6.8.0.

\item Fixed problems with \Condor{store\_cred} behaving strangely when
storing or removing a user name that is some initial substring of
``condor\_pool''. Specifying such a user name would be incorrectly
interpreted as equivalent to specifying the \Opt{-c} option.

\item Fixed a problem with \Condor{glidein} spewing lots of text to
the screen when checking the status of a job it submitted.

\item A new version of the GT4 GAHP is included, with the following changes:

  \begin{itemize}

  \item A new \File{axis.jar} from Globus fixes a thread safety bug that
  can cause lockups in subscriptions for WS notifications. See Globus
  Bugzilla 4858
  (\URL{http://bugzilla.globus.org/bugzilla/show\_bug.cgi?id=4858}).

  \item Fixed bugs that caused memory related to destroyed jobs to not
  be reclaimed in both the client and the server.

  \item Removed redundant usage of Secure Message, Secure Conversation,
  and Transport Security when talking to a WS GRAM service. Now, only
  Transport Security is used.

  \end{itemize}

\item Fixed memory leaks in \Condor{quill}.

\item Fixed a bug that might have caused \Condor{startd} problems
launching the \Condor{starter} for the standard universe on 64-bit systems.

\item Improved Condor's file transfer.  If you request that Condor
automatically transfer back your output, it now detects changes better.
Previously, it would only transfer back files that had a more recent timestamp 
than the spool date.  Now, it will transfer back any file that has changed
in date (including being dated in the past) or changed in size.

\end{itemize}

\noindent Known Bugs:

\begin{itemize}

\item SuSE Linux Enterprise Server 9 on PowerPC only: The default Java
interpreter on SuSE Linux Enterprise Server 9 running on the PowerPC
architecture has compatibility problems with this release of Condor.  The
problem exhibits itself as the \Condor{startd} hanging, never reporting itself
to the \Condor{collector}.  The workaround is to either disable the Java
universe (set \MacroNI{JAVA} to an empty string), or disable just-in-time
compilation when running in the Java universe with the following configuration
setting:
\begin{verbatim}
  JAVA_EXTRA_ARGUMENTS = -Djava.compiler=NONE
\end{verbatim}

\end{itemize}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{\label{sec:New-6-8-2}Version 6.8.2}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\noindent Release Notes:

\begin{itemize}

\item Condor now uses Globus 4.0.3 for GSI, GRAM, and GridFTP support.
This includes a patch for the OpenSSL vulnerability detailed in 
CVE-2006-4339 and \URL{http://www.openssl.org/news/secadv\_20060905.txt}.
It also includes fixes for Globus Bugzilla 4689 
(\URL{http://bugzilla.globus.org/bugzilla/show\_bug.cgi?id=4689}) and a 
bug that can cause duplicate UUIDs to be generated for WS GRAM jobs.

\item The \Condor{schedd} daemon no longer forks separate processes to 
change ownership of job directories in the spool.
Previously on Unix-like systems, this would create a
new process before a job started running and after it finished running.   Some
sites with very busy \Condor{schedd} daemons were encountering scaling problems.

\end{itemize}

\noindent New Features:

\begin{itemize}

\item Because, by default, the \Condor{startd} daemon references the job
ClassAd attribute \AdAttr{NumCkpts}, Condor's default configuration
will now round up the value of \AdAttr{NumCkpts}, in order to improve 
matchmaking performance.  See the entry on \Macro{SCHEDD\_ROUND\_ATTR}
in section~\ref{param:ScheddRoundAttr}.

\item Enhanced the RHEL3 x86\_64 port of Condor to include the standard
universe.

% Gnats PR 757
\item \Condor{submit\_dag} \Opt{-f} no longer deletes the
\File{dagman.out} file.  \Condor{submit\_dag} without the \Opt{-f}
option will now submit a DAGMan run even if the \File{dagman.out}
file exists.  In this case, the file will be appended to.

\item Added a property to the Windows installer program to determine
whether the Condor service will be started after installation. The
property name is STARTSERVICE, and the default value is ``Y''.

\end{itemize}

\noindent Bugs Fixed:

\begin{itemize}

\item A bug caused the \Condor{master} daemon to kill
only immediate children within the process tree,
upon an abnormal exit of the \Condor{master} daemon. 
The \Condor{master} daemon now kills all descendant processes.

\item Fixed a bug where if the file system was full, the debugging log
files (for example \File{SchedLog}) would silently lose messages.  Now,
if the disk is full, the Condor daemons will 
exit.

\item Fixed a bug in the \Condor{schedd} daemon that caused it to stop
negotiating for grid universe jobs in the case that it decided
it could not spawn any new \Condor{shadow} processes.

% Gnats PR 751
\item Added the ProcessId class (which more uniquely identifies a
process than a PID does) to the \Condor{dagman} abort duplicate
runs feature.  This makes it less likely that a given instance of
\Condor{dagman} will mistakenly conclude that another instance of
\Condor{dagman} is already running on the same DAG.  Also fixed an
unrelated bug in the abort duplicate runs feature that could cause
a \Condor{dagman} to not abort itself when it should.

\item Condor daemons leaked memory (consuming more and more memory over time)
when parsing ClassAds that use functions with arguments.

% Gnats PR 743
\item Fixed a bug in the \Condor{starter} daemon,
which caused it to look in the
wrong place for the job's executable, if \Attr{TransferExecutable} was set
to \Expr{True} in the job ClassAd.

\item \Condor{history} no longer crashes if \Attr{HISTORY} is not defined
in the Condor configuration file.

\item Fixed an unintentional change to the value of \Opt{-Condorlog}
in a \Condor{dagman} submit description file: it is once again the log file of
the first node job.

\item Fixed a bug in \Condor{q} that would cause \Condor{q} \Opt{-hold} or
\Condor{q} \Opt{-run} to exit with an error on some platforms.

\item Fixed a bug on Unix platforms, in which a misconfiguration of
\MacroNI{MAIL} would cause the \Condor{master} daemon to restart
all of its child
daemons whenever it tried (and failed) to send e-mail to the
administrator.

\item Network related error messages have been improved to make debugging
easier.  For example, when timing out on a read or write operation, the
peer's address is now included in the error message.

\item An invalid value for \MacroNI{UPDATE\_INTERVAL} now causes
the \Condor{startd} daemon to abort.  Previously, it would continue running,
but some invalid values (for example, 0) could cause it to stop sending
periodic ClassAd updates to the \Condor{collector}, even after being
reconfigured with a valid value.  Only a complete restart of
the \Condor{startd} daemon was sufficient to get it out of this state.

\item Fixed a bug that caused X.509 limited proxies to be delegated as 
impersonation (i.e. non-limited) proxies. Any authentication attempted
with the resulting proxies would fail.

\item Fixed a couple bugs that would cause Condor to lose track of
some Condor-related processes and subsequently fail to clean up (kill)
these processes.

\item Fixed a bug that would cause \Condor{history} to crash when
dealing with rotated history files. Note that history file rotation is
turned on by default. (See
Section~\ref{sec:Condor-wide-Config-File-Entries} for descriptions of
\Macro{ENABLE\_HISTORY\_ROTATION} and
\Macro{MAX\_HISTORY\_ROTATIONS}.)

\end{itemize}

\noindent Known Bugs:
\begin{itemize}

\item None.

\end{itemize}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{\label{sec:New-6-8-1}Version 6.8.1}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\noindent Release Notes:

\begin{itemize}

\item Version 6.8.1 fixes important bugs, some of which have
security implications.  All users are encouraged to upgrade, and full
disclosure of the vulnerabilities will be given at the end of October 2006.

\item Condor is now linked against GSI from Globus 4.0.2. This includes
a patch for Globus Security Advisories 2006-01 
(\URL{http://www.globus.org/mail\_archive/security-announce/2006/08/msg00000.html})
and 2006-02 
(\URL{http://www.globus.org/mail\_archive/security-announce/2006/08/msg00001.html}).
It also includes a
patch for the OpenSSL vulnerability detailed in CVE-2006-4339 and
\URL{http://www.openssl.org/news/secadv\_20060905.txt}.

\item The PCRE (Perl Compatible Regular Expressions) library used by
Condor is now dynamically linked and shipped as a DLL with Condor for
Windows, rather than being statically linked.

\end{itemize}


\noindent New Features:

\begin{itemize}

% Gnats PR 610
\item Added an optional argument to the \Condor{dagman} ABORT-DAG-ON
command that allows the DAGMan exit code to be specified separately
from the node value that causes the abort; also, a DAG can now be
aborted on a zero exit code from a node.

% I implemented in condor_rm.  Todd is handling condor_schedd implementation.
\item Added the \Macro{ALLOW\_FORCE\_RM} configuration variable.
If this expression evaluates to \Expr{True},
then an \Condor{rm} -f attempt is allowed.  If it evaluated to \Expr{False},
the attempt is disallowed.
The expression is evaluated in the context of the job ClassAd.
If not defined, the value defaults to \Expr{True}, matching the behavior of
previous Condor releases.

% Gnats PR 664
\item \Condor{dagman} will now reject DAGs for which any of the nodes'
user job log files are on NFS (because of the unreliability of NFS
file locking, this can cause DAGs to fail).  This feature can be
turned off by setting the \MacroNI{DAGMAN\_LOG\_ON\_NFS\_IS\_ERROR}
configuration macro to \Expr{False} (the default is \Expr{True}).

\item \Condor{submit} can now be configured to reject jobs for which
the log file is on NFS.
To do this, set the \MacroNI{LOG\_ON\_NFS\_IS\_ERROR}
configuration macro to \Expr{True}.
The default is that \condor{submit} will issue a warning
for a log file on NFS.

\item Added the \MacroNI{DAGMAN\_ABORT\_DUPLICATES} configuration macro,
which causes
\Condor{dagman} to attempt to detect at startup whether another
\Condor{dagman} is already running on the same DAG; if so, the second
\Condor{dagman} will abort itself.

\item The new configuration variable
\MacroNI{NETWORK\_MAX\_PENDING\_CONNECTS} may be used to limit the
maximum number of simultaneous network connection attempts.  This is
primarily relevant to the \Condor{schedd} daemon, which may try to connect to
large numbers of \Condor{startd} daemons when claiming them.
The \Condor{negotiator} may also
connect to large numbers of \Condor{startd} daemons when initiating
security sessions
used for sending MATCH messages.  On Unix, the default is to allow up to
eighty percent of the process file descriptor limit.  On Windows, the
default is 1600.

% Gnats 734/condor-admin 13872
\item Added some more debug output to \Condor{dagman} to clarify
fatal errors.

\item The -format argument to \Condor{q} and \Condor{status} can now take an expression in addition to a simple attribute name.

\item DRMAA is now available on most Linux platforms, Windows and PPC MacOS.

\end{itemize}

\noindent Bugs Fixed:

\begin{itemize}

\item When a large number of jobs (roughly 200 or more) are running from a
single \Condor{schedd} daemon, and those jobs are using job leases
(the default in 6.8), it is
possible for the \Condor{schedd} daemon to enter a state 
where it crashes on startup until all of
the job leases expire.
% The bug is more generic; it potentially hit any user of GenericQuery or
% CondorQuery, but we know of no users encountering the bug in any other cases.

\item Condor jobs submitted with the \AdAttr{NiceUser} priority were
  not being matched if the \Macro{NEGOTIATOR\_MATCHLIST\_CACHING}
  setting was TRUE (which is enabled by default).

\item Fixed a Quill bug that prevented it from running on Windows.  The
symptom showed with errors in the QuillLog such as
\begin{verbatim}
POLLING RESULT: ERROR
\end{verbatim}

\item Fixed a bug in Quill where it would cause errors such as
\begin{verbatim}
duplicate key violates unique constraint "history_vertical_pkey"
\end{verbatim}
in the QuillLog and the \Prog{PostgreSQL} log file.  These errors
triggered
a significant slowdown in the performance of Quill and the database.  This
would only happen when a job attribute changed type from a string
type to a numeric type, or vice versa.

%% This is the change to datathread.C
\item In those unusual cases where Condor is unable to create a new process,
it shuts down cleanly, eliminating a small possibility of data corruption.

\item Fixed a bug with the gt4 and nordugrid grid universe jobs that
caused the \File{stdout} and \File{stderr} of a job to not be 
transferred correctly, if the given file names had absolute paths.

% Gnats PR 711
\item \Condor{dagman} now echos warnings from \Condor{submit} and
%\Stork{submit} to the \File{dagman.out} file.
\Prog{stork\_submit} to the \File{dagman.out} file.

\item Fixed a bug introduced in 6.7.20, causing the \Condor{ckpt\_server}
to exit immediately after starting up, unless Condor's security
negotiation was disabled.

% This was a bug because the default configuration file and manual
% both claimed it defaulted to 1MB.
\item \Macro{MAX\_<SUBSYS>\_LOG} defaults to one Megabyte, even if the
setting is missing from the configuration.  Previously it was 64 Kilobytes.

% this is the change to condor_secman.C by zmiller
\item Fixed a bug related to non-blocking connect that could occasionally
cause Condor daemons to crash.

% collector.C change: eliminated useless fprintf(stderr).
\item Fixed a rare bug where an exceptionally large query to the
\Condor{collector} could cause it to crash.  The most common cause was a single
\Condor{schedd} daemon restarting,
and trying to recover a large number of job leases at once.
More than approximately 250 running jobs on a single \Condor{schedd} daemon
would be necessary to trigger this bug.

\item When using the \Macro{JOB\_PROXY\_OVERRIDE\_FILE} configuration
parameter, the X.509 proxy will now be properly forwarded for Condor-C jobs.

\item Greatly reduced the chance that a Condor-C job in the REMOVED state
will be HELD due to an expired proxy or failure to talk to the remote
\Condor{schedd}.

\item Fixed error and debug messages added in Condor version 6.7.20 that
incorrectly reported IP and port numbers.  These messages were
intended to report the peer's address, but they were instead reporting the
local address of the network socket.

\item Fixed a bug introduced in Condor version 6.7.20
which could cause Condor daemons to
die with the message 
\begin{verbatim}
PANIC -- OUT OF FILE DESCRIPTORS
\end{verbatim}
The conditions
causing this related to failed attempts to send updated status
to the \Condor{collector} daemon,
with both non-blocking updates and security negotiation
enabled (the defaults).

\item Also fixed a bug in the negotiator with the same effect as
above, except it only happened with the configuration setting
\MacroNI{NEGOTIATOR\_USE\_NONBLOCKING\_STARTD\_CONTACT}=False.

\item Fixed a bug in \Condor{schedd} under Solaris that could also
cause file descriptors to become exhausted over time when many
machines were claimed in a short spans of time (e.g. over 100) and the
\Condor{schedd} process file descriptor limit was near 256.

\item Fixed a bug in \Condor{schedd} under Windows that could cause
network sockets to be allocated and never released back to the system.
The circumstances that could cause this were very rare.  The error
message in the logs indicating that this problem was happening is
\begin{verbatim}
ERROR: DuplicateHandle() failed in Sock::set_inheritable
\end{verbatim}
In cases where this error message is displayed, the network socket
is closed.

\item Under some conditions, when making TCP connections, Condor was
still trying to connect for the full duration of the operation timeout
(often 10 or 20 seconds), even if the connection attempt was refused
(for example, because the port being accessed is not accepting connections).
Now, the connect operation finishes immediately after the first such
failure, allowing the Condor process to continue with other tasks.

\item Fixed the problems relating to credential cache problems in the Kerberos
authentication mechanism.  The current version of Kerberos is 1.4.3.

% changes to condor_auth_ssl.C by zmiller
\item Fixed bugs in the SSL authentication mechanism that caused the
\Condor{schedd} to crash when submitting a job (on Unix) and caused
all tools and daemons to crash on Windows when using SSL.

\item Some of the binaries required to use Condor-C on Windows were
mistakenly not included in previous releases of Condor. This has been
fixed.

\item Fixed a problem on Windows where the \Condor{startd} could fail to
include some attributes in its ClassAd. This would result in some jobs
incorrectly not being matched to that machine.  This only happened if
\Macro{CREDD\_HOST} was defined and Condor daemons on the execute
machine were unable to authenticate with the \Condor{credd}.

\item Fixed a \Condor{dagman} bug which had prevented the
\MacroUNI{DAGManJobId} attribute from being expanded in job submit files
(for example,
when used as the value to define the \SubmitCmd{Priority} command).

\item Fixed a bug in \Condor{submit} that caused parallel universe jobs
submitted via Condor-C to become mpi universe jobs.

\item Fixed a bug which could cause Condor daemons to hang if they try
to write to the standard error stream (\File{stderr}) on some platforms.  In
general, this should never happen, but can, due to third party
libraries (beyond our control) trying to write error or other messages.

\item Fixed \Condor{status} to report error messages.

\item Fixed a bug in which setting the configuration variable 
\begin{verbatim}
NEGOTIATOR_CONSIDER_PREEMPTION = False
\end{verbatim}
caused an incorrect calculation.
The fraction of the pool already being claimed by a user was
calculated using the wrong total number of \Condor{startd} daemons.
This could cause some \Condor{startd} daemons to remain unclaimed,
even when there were jobs available to run on them.

% zmiller's changes to condor_io/condor_auth_fs.C
\item Fixed a security vulnerability in Condor's FS and FS\_REMOTE
authentication methods.  The vulnerability allowed an attacker to impersonate
another user on the system, potentially allowing submission of jobs as a
different user.  This may allow escalation to root privilege if the Condor
binaries and configuration files have improper permissions.  The fix is not
backwards compatible, which means all daemons and tools using FS authentication
must be running Condor 6.8.1 or greater.  The same applies to FS\_REMOTE; All
daemons and tools using FS\_REMOTE must be using Condor 6.8.1 or greater.  In
practice, this means that for FS, all Condor binaries on one host must be
version 6.8.1 or greater, but versions can be different from host to host.  For
FS\_REMOTE it means all binaries across all hosts must be 6.8.1 or greater.

% zmiller's changes to condor_credd/credd.C and stork/dap_server.C
\item Fixed a couple race conditions in stork and the credd where credential
files were possibly created with improper permissions before being set to owner
permissions.

\item Fixed a bug in the \Condor{gridmanager} that caused it to delegate
12-hour proxies for grid-type gt4 jobs and then not refresh them.

\item Fixed a bug in the \Condor{gridmanager} that caused a directory
needed for staging-in of grid-type gt4 job files to be removed when
the \Condor{Gridmanager} exited, causing the stage-in to fail.

% Condor-admin 14075
\item Fixed a bug that caused the \Term{checkpoint server} to restart
because of (ostensibly) getting an unexpected errno from select().

\item Fixed a bug on Windows where setting \SubmitCmd{output} or
\SubmitCmd{error} to a relative or absolute path (as opposed to a
simple file name without path information) would not work properly.

\item History file rotation did not previously work on Windows because
the name of a rotated files would contain an ISO 8601 extended format
timestamp, which contains colon characters. The naming convention for
rotated files has been modified to use ISO 8601 basic format, avoiding
this problem.

\item The CLAIMTOBE authentication method (which is inherently
insecure and should only be used for testing or other special
circumstances) previously would authenticate without providing the
``domain'' portion of the user name. As an example, a user would be
authenticated as simply ``user'' rather than
``user@cs.wisc.edu''. This problem has been fixed, but the new
protocol is not backwards compatible so the fix is turned off by
default. Correct behavior can be enabled by setting the
\Macro{SEC\_CLAIMTOBE\_INCLUDE\_DOMAIN} parameter to \Expr{True}.

\item Fixed a bug with the \MacroNI{NEGOTIATOR\_MATCHLIST\_CACHING} that
would cause very low-priority jobs (like jobs submitted with
\MacroNI{nice\_user=True}) to not match even if resources were available.

\item Fixed a buffer overflow that could crash the \Condor{negotiator}.

\item \MacroNI{SCHEDD\_ROUND\_ATTR\_<xxxx>} preserves the value being
rounded up when it is a multiple of the power of 10 specified for
rounding.  Previously, the value would be incremented; now it remains
the same.  For example, if SCHEDD\_ROUND\_ATTR\_<xxxx>=2 and the value
being rounded up is 100, it now remains 100, rather than being
incremented to 200.

\item Fixed \Condor{updates\_stats} to report it's version number
correctly.

\end{itemize}

\noindent Known Bugs:

\begin{itemize}

\item The \Opt{-completedsince} option to \Condor{history} works
when Quill is enabled.  The behavior of \Condor{history}
\Opt{-completedsince} is undefined when Quill is \emph{not}
enabled.

\end{itemize}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{\label{sec:New-6-8-0}Version 6.8.0}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\noindent Release Notes:

\begin{itemize}

\item The default configuration for Condor now requires that
\Macro{HOSTALLOW\_WRITE} be explicitly set.  Condor will refuse
to start if the default configuration is used unmodified.
Existing installations should not need to change anything.  For
those who desire the earlier default, you can set it to "*", but
note that this is potentially a security hole allowing anyone to
submit jobs or machines to your pool.

\item Most Linux distributions are now supported using dynamically
  linked binaries built on a RedHat Enterprise Linux 3 machine.
  Recent security patches to a number of Linux distributions have
  rendered the binaries built on RedHat 9 machines ineffective.
  The download pages have been changed to reflect this, but Linux users
  should be aware of this change.
  The recommended download for most x86 Linux users is now:
  \File{condor-6.8.0-linux-x86-rhel3-dynamic.tar.gz}.

\item Some log messages have been clarified or moved to different
  debugging levels.
  For example, certain messages that looked like errors were printed
  to \MacroNI{D\_ALWAYS}, even though nothing was wrong and the system was
  behaving as expected.

\item The new features and bugs fixed in the rest of this section only
  refer to changes made since the 6.7.20 release, not the last stable
  release (6.6.11).
  For a complete list of changes since 6.6.11, read the 6.7 version
  history in section~\ref{sec:History-6-7} on
  page~\pageref{sec:History-6-7}. 

\end{itemize}


\noindent New Features:

\begin{itemize}

\item Version 1.4 of the Condor DRMAA libraries are now included 
  with the Condor release.
  For more information about DRMAA, see section~\ref{API-DRMAA} on
  page~\pageref{API-DRMAA}.

\item Version 1.0.15 of the Condor GAHP is now used for Condor-G and
  Condor-C. 

% Gnats PR 710
\item Added the \Opt{-outfile\_dir} command-line argument to
\Condor{submit\_dag}.  This allows you to change the directory in which
\Condor{dagman} writes the \File{dagman.out} file.

\item Added a new \Opt{--summary} (also \Opt{-s}) option to the
\Condor{update\_stats} tool.  If enabled, this prevents it from
displaying the entire history for each machine and only displays the
summary info.

\end{itemize}

\noindent Bugs Fixed:

\begin{itemize}

\item Fixed a number of potential static buffer overflows in various
  Condor daemons and libraries.

\item Fixed some small memory leaks in the \Condor{startd},
  \Condor{schedd}, and a potential leak that effected all Condor
  daemons.

\item Fixed a bug in Quill which caused it to crash when certain
long attributes appeared in a job ad.

\item The startd would crash after a reconfig if the address of a
collector had not been resolved since the previous reconfig
(e.g. because DNS was down during that time).

\item Once a Condor daemon failed to lookup the IP address of the
collector (e.g. because DNS was down), it would fail to contact the
collector from that time until the next reconfig.  Now, each time Condor
tries to contact the collector, it generates a fresh DNS query if the
previous attempt failed.

% Gnats PR 707
\item When using Condor-C or the -s or -r command-line options to
\condor{submit}, the job's standard output and error would be placed
in the job's initial working directory, even if the job ad said to
place them in a different directory.

% Gnats PRs 501 and 663
\item Greatly sped up the parsing of large DAGs (by a factor of 50
or so) by using a hash table instead of linear search to find DAG nodes.

% Gnats PR 697
\item Fixed a bug in \Condor{dagman} that caused an EXECUTABLE\_ERROR
event from a node job to abort the DAG instead of just marking the
relevant node as failed.

\item Fixed a bug in \Condor{collector} that caused it to discard
machine ads that don't have an IP address field (either StartdIpAddr
or STARTD\_IP\_ADDR).  The \Condor{startd} will always produce a
StartdIpAddr field, but machine ads published through
\Condor{advertise} may not.

\item When using \MacroNI{BIND\_ALL\_INTERFACES} on a dual-homed
machine, a bug introduced in 6.7.18 was causing Condor daemons to
sometimes incorrectly report their IP addresses, which could cause
jobs to fail to start running.

\item Made the event checking in \Condor{dagman} less strict: 
added the new "allow duplicate events" value to the
\MacroNI{DAGMAN\_ALLOW\_EVENTS} macro (this value is part of the
default); 16 value now also allows terminate event before submit;
changed "allow all events" to "allow almost all events"
(all except "run after terminal event"), so it is more useful.

% Gnats PR 712
\item \Condor{dagman} and \Condor{submit\_dag} now report
\Opt{-NoEventChecks} as ignored rather than deprecated.

\item Fixed a bug in the \Condor{dagman} \Opt{-maxidle} feature:
a shadow exception event now puts the corresponding job into the
idle state in \Condor{dagman}'s internal count.

\item Fixed a problem on Windows where daemons would sometimes crash
when dealing with UNC path names.

\item Fixed a problem where the \Condor{schedd} on Windows would
incorrectly reject a job if the client provided an \Attr{Owner}
attribute that was correct but differed in case from the authenticated
name.

\item Fixed a \Condor{startd} crash introduced in version 6.7.20. This
crash would appear if an execute machine was matched for preemption
but then not claimed in time by the appropriate \Condor{schedd}.

\item Resolved an issue where the \Condor{startd} was unable to clean
up jobs' execute directories on Windows when the \Condor{master} was
started from the command line rather than as a service.

\item Added more patches to Condor's DRMAA interface to make it more
compatible with Sun Grid Engine's DRMAA interface.

\item Removed the unused \MacroNI{D\_UPDOWN} debug level and added the
  \MacroNI{D\_CONFIG} debug level.

\item Fixed a bug that caused \Condor{q} with the \Opt{-l} or \Opt{-xml}
arguments to print out duplicate attributes when using Quill.

\item Fixed a bug that prevented Condor-C jobs (universe grid jobs of type condor)
from submitting correctly if \MacroNI{QUEUE\_ALL\_USERS\_TRUSTED} is set to
True.

\item Fixed a bug that could cause the \Condor{negotiator} to crash if the
pool contains several different versions of the \Condor{schedd} and in the
config file \MacroNI{NEGOTIATOR\_MATCHLIST\_CACHING} is set to True.

\item Changed the default value for config file entry
\MacroNI{NEGOTIATOR\_MATCHLIST\_CACHING} from False to True.  When set to
True, this will instruct the negotiator to safely cache data in order to
improve matchmaking performance.

\item The \Condor{master} now recognizes \Condor{quill} as a valid
  Condor daemon without any manual configuration on the part of site
  administrators.
  This simplifies the configuration changes required to enable Quill. 

\item Fixed a rare bug in the \Condor{starter} where if there was a
  failure transferring job output files back to the submitting host,
  it could hang indefinitely, and the job appeared as if it was
  continuing to run.

\end{itemize}


\noindent Known Bugs:

\begin{itemize}

\item The \Opt{-completedsince} option to \Condor{history} works
when Quill is enabled.  The behavior of \Condor{history}
\Opt{-completedsince} is undefined when Quill is \emph{not}
enabled.

\end{itemize}

