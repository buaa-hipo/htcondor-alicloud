\section{\label{sec:clouds-config}HTCondor Annex Configuration}

While the configuration macros in this section may be set by the HTCondor
administrator, they are intended for the user-specific HTCondor configuration
file (usually {\tt \textasciitilde/.condor/user\_config}).  Although we
document every macro, we expect that users will generally only want to
change a few of them, listed in section \ref{sec:clouds-config-users};
the entries required in by \Condor{annex} in other sections will be
generated by its setup procedure.

Subsequent sections deal with logging
(section \ref{sec:clouds-logging}),
are for expert users
(section \ref{sec:clouds-config-experts}),
or for HTCondor developers
(section \ref{sec:clouds-config-developers}).

\subsection{\label{sec:clouds-config-users}User Settings}

\begin{description}

\label{param:AnnexDefaultLeaseDuration}
\item[\Macro{ANNEX\_DEFAULT\_LEASE\_DURATION}]
  The duration of an annex if not specified on the command-line; specified
  in seconds.  Defaults to 50 minutes.

\label{param:AnnexDefaultUnclaimedTimeout}
\item[\Macro{ANNEX\_DEFAULT\_UNCLAIMED\_TIMEOUT}]
  How long an annex instances should stay idle before shutting down;
  specified in seconds.  Defaults to 15 minutes.

\label{param:AnnexDefaultODIKeyName}
\item[\Macro{ANNEX\_DEFAULT\_ODI\_KEY\_NAME}]
  The name of the SSH key pair \Condor{annex} should use by default.
  No default.

\label{param:AnnexDefaultODIInstanceTypes}
\item[\Macro{ANNEX\_DEFAULT\_ODI\_INSTANCE\_TYPE}]
  The AWS instance type to use for on-demand instances if not specified.
  No default, but the \Condor{annex} setup procedure sets this to
  \mbox{`m4.large'}.

\label{param:AnnexDefaultODIImageID}
\item[\Macro{ANNEX\_DEFAULT\_ODI\_IMAGE\_ID}]
  The AWS AMI to use for on-demand instance if not specified.
  No default, but the \Condor{annex} setup procedure sets this to
  \mbox{`ami-35b13223'}.

\label{param:AnnexDefaultSFRConfigFile}
\item[\Macro{ANNEX\_DEFAULT\_SFR\_CONFIG\_FILE}]
  The JSON configuration file use by \Condor{annex} when creating a Spot-based
  annex.  No default.

\end{description}

\subsection{\label{sec:clouds-logging}Logging}

By default, running \Condor{annex} creates three logs: the \Condor{annex} log,
the annex GAHP log, and the annex audit log.  The default location for these
logs is the same directory as the user-specific HTCondor configuration file
(usually {\tt \textasciitilde/.condor/user\_config}).  \Condor{annex} sets the
\Macro{LOG} macro to this directory when reading its configuration.

The \Condor{annex} log is a daemon-style log.  It is configured as if
\Condor{annex} were a daemon with subsystem type \MacroNI{ANNEX};
see section \ref{sec:Daemon-Logging-Config-File-Entries} for details.

\Condor{annex} uses special helper programs, called GAHPs, to interact
with the different cloud services.  These programs do their own logging,
writing to the annex GAHP log.  The annex GAHP log is configured as if it
were a daemon, but with subsystem type \MacroNI{ANNEX\_GAHP}; see section
\ref{sec:Daemon-Logging-Config-File-Entries} for details.

The annex audit log records two lines for each invocation of \Condor{annex}:
the command as issued and the results as returned.  The location of the
audit log is set by \Macro{ANNEX\_AUDIT\_LOG}, which is the
\MacroNI{AUDIT}-level log for the \MacroNI{ANNEX} subsystem; see
\MacroNI{<SUBSYS>\_<LEVEL>\_LOG} (\ref{param:SubsysLevelLog}) for details.
Because annex creation commands typically make extensive use of values set
in configuration, \Condor{annex} will write the configuration it used for
annex creation commands into the audit log if \MacroNI{ANNEX\_DEBUG} includes
\MacroNI{D\_AUDIT:2}.

\subsection{\label{sec:clouds-config-experts}Expert Settings}

\begin{description}

\label{param:AnnexDefaultEC2URL}
\item[\Macro{ANNEX\_DEFAULT\_EC2\_URL}]
  The AWS EC2 endpoint that \Condor{annex} should use.  Defaults to
  \mbox{`https://ec2.us-east-1.amazonaws.com'}.

\label{param:AnnexDefaultCWEURL}
\item[\Macro{ANNEX\_DEFAULT\_CWE\_URL}]
  The AWS CloudWatch Events endpoint that \Condor{annex} should use.
  Defaults to \mbox{`https://events.us-east-1.amazonaws.com'}.

\label{param:AnnexDefaultLambdaURL}
\item[\Macro{ANNEX\_DEFAULT\_LAMBDA\_URL}]
  The AWS Lambda endpoint that \Condor{annex} should use.  Defaults to
  \mbox{`https://lambda.us-east-1.amazonaws.com'}.

\label{param:AnnexDefaultS3URL}
\item[\Macro{ANNEX\_DEFAULT\_S3\_URL}]
  The AWS S3 endpoint that \Condor{annex} should use.  Defaults to
  \mbox{`https://s3.amazonaws.com'}.

\label{param:AnnexDefaultCFURL}
\item[\Macro{ANNEX\_DEFAULT\_CF\_URL}]
  The AWS CloudFormation endpoint that \Condor{annex} should use.  Defaults to
  \mbox{`https://cloudformation.us-east-1.amazonaws.com'}.

\label{param:AnnexDefaultAccessKeyFile}
\item[\Macro{ANNEX\_DEFAULT\_ACCESS\_KEY\_FILE}]
  The full path to the AWS access key file \Condor{annex} should use.
  No default.

\label{param:AnnexDefaultSecretKeyFile}
\item[\Macro{ANNEX\_DEFAULT\_SECRET\_KEY\_FILE}]
  The full path to the AWS secret key file \Condor{annex} should use.
  No default.

\label{param:AnnexDefaultS3Bucket}
\item[\Macro{ANNEX\_DEFAULT\_S3\_BUCKET}]
  A private S3 bucket that the \MacroNI{ANNEX\_DEFAULT\_ACCESS\_KEY\_FILE}
  and \MacroNI{ANNEX\_DEFAULT\_SECRET\_KEY\_FILE} may write to.  No default.

\label{param:AnnexDefaultODISecurityGroupIDs}
\item[\Macro{ANNEX\_DEFAULT\_ODI\_SECURITY\_GROUP\_IDS}]
  The default security group for on-demand annexes.  Must permit inbound
  HTCondor (port 9618).

\end{description}

\subsection{\label{sec:clouds-config-developers}Developer Settings}

\begin{description}

\label{param:AnnexDefaultConnectivityFunctionARN}
\item[\Macro{ANNEX\_DEFAULT\_CONNECTIVITY\_FUNCTION\_ARN}]
  The name (or ARN) of the Lambda function on
  AWS which \Condor{annex} should use to check if the configured collector
  can be contacted from AWS.

\label{param:AnnexDefaultODIInstanceProfileARN}
\item[\Macro{ANNEX\_DEFAULT\_ODI\_INSTANCE\_PROFILE\_ARN}]
  The ARN of the instance profile \Condor{annex} should use.  No default.

\label{param:AnnexDefaultODILeaseFunctionARN}
\item[\Macro{ANNEX\_DEFAULT\_ODI\_LEASE\_FUNCTION\_ARN}]
  The Lambda function which implements the lease
  (duration) for on-demand instances.  No default.

\label{param:AnnexDefaultSFRLeaseFunctionARN}
\item[\Macro{ANNEX\_DEFAULT\_SFR\_LEASE\_FUNCTION\_ARN}]
  The Lambda function which implements the lease
  (duration) for Spot instances.  No default.

\end{description}
